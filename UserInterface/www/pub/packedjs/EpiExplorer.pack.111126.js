function getQuery(a,b,c){var f=[],e="span.nonExistingClass";"main"==c?(e="span.queryPrefixRaw",f=["Eregion"]):"ref"==c?(e="span.referencePrefixRaw",f=["Eregion"]):alert("Invalid query type "+c);$(e).each(function(){f.push($(this).text())});return getQueryFromParts(a,b,f)}
function getQueryFromParts(a,b,c){var f="",e="",d="",g=[];$.each(c,function(b,c){"-"==c.charAt(0)?f=0<f.length?f+a+c:c:"["==c.charAt(0)?g.push(c.replace(/ /g,a)):e=0<e.length?e+a+c:c});0<e.length?(d=e,0<b.length&&(d=d+a+b),0<f.length&&(d=d+a+f)):d=0<f.length?0<b.length?b+a+f:"Eregion"+a+f:b;0<g.length&&(d=0<d.length?g.join(a)+a+d:g.join(a));return d=d.replace(/OVERLAP/g,settings.overlap).replace(/TISSUE/g,settings.tissue)}
function getQueryComplexJoin(a,b,c,f,e){for(var e=0<e.length?e+a+f:f,b=getQuery(a,0<b.length?b+a+f:f,"main"),f=[],d=b.indexOf("[");-1<d;){var g=b.indexOf("]");f.push(b.substring(d,g+1));var i="";0<d&&(i=b.substring(0,d-1));g<b.length-1&&(i+=b.substring(g+2));b=i;d=b.indexOf("[")}query="["+b+"%23"+e+"]";""!=c&&(query=query+a+c);0<f.length&&(query=f.join(a)+a+query);return query}
function selectCast(){$("td.castItem b").hide();$("td.castItem a").show();$(this).hide();$(this).siblings("b").show();$("#castFrame").attr("src",$(this).siblings("input:hidden")[0].value)}function removeUserDatasetFromLists(a){a=jQuery.inArray(a,currentState.userDatasets);-1!=a&&(currentState.userDatasets.splice(a,1),$.cookie("cgs:settings:userdatasets:"+settings.genome,currentState.userDatasets.join(";"),{expires:30}))}
function addUserDatasetRow(a){var b=$('<tr class="regionsButton regionsButtonHover regionUser" title="See more information"></tr>');b.append($('<input type="hidden" value="'+a+'"/>'));var c=$('<td title="Remove this custom dataset" class="removeUserDataset hoverChangeIcon"><img src="extras/edit-clear-locationbar-ltr.png" class="removeDatasetIcon"/><input type="hidden" value="'+a+'"/></td>');c.click(function(a){a.stopPropagation();var a=$(this).parent(),b=a.children("input:hidden").val();removeUserDatasetFromLists(b);
a.remove()});b.append(c);b.append($('<td class="regionsetSelectButton" align="left" title="Explore this dataset">'+currentState.datasetInfo[a].officialName+"</td>"));b.append($('<td class="regionsetSelectButton" align="right" title="Explore this dataset"> '+numberWithCommas(currentState.datasetInfo[a].numberOfRegions)+" </td>"));b.append($('<td align="center" class="regionsetSelectButton hoverChangeIcon" title="Explore this dataset"><img src="extras/media-playback-start.png" class="selectDatasetIcon"></img><div class="selectDatasetText">Select</div></td>'));
$("#regionsTable").prepend(b)}
function activateUserDatasetFunction(a,b,c,f){"Paste here a dataset ID and press enter"==a?b&&($(".activateUserDatasetSpan").show(),$(".activateUserDatasetSpan").text("You need to enter a dataset ID, first").fadeOut(2E3,function(){})):""==a?b&&($(".activateUserDatasetSpan").show(),$(".activateUserDatasetSpan").text("Please, insert a valid user dataset ID").fadeOut(4E3,function(){$(".activateUserDatasetSpan").text("")})):(!0==b&&($(".activateUserDatasetSpan").show(),$(".activateUserDatasetSpan").text("Activating the dataset..")),$.ajax({type:"GET",
url:"relay.php",async:c,dataType:"json",data:"type=activateUserDataset&datasetID="+a,success:function(c){1==c[0]?(removeUserDatasetFromLists(a),!0==b&&($(".activateUserDatasetSpan").show(),$(".activateUserDatasetSpan").text(c[1]))):(!1==b?(currentState.datasetInfo[a]=c[2],f&&addUserDatasetRow(a)):$(".activateUserDatasetSpan").text(c[1]).fadeOut(2E3,function(){$(".activateUserDatasetSpan").text("");currentState.datasetInfo[a]=c[2];f&&addUserDatasetRow(a);showInfoRegionSet(a,!0);currentState.exploreRegionSelected=
a;updateCurrentSelectionOverlapPlot(!1)}),-1==jQuery.inArray(a,currentState.userDatasets)&&(currentState.userDatasets.push(a),$.cookie("cgs:settings:userdatasets:"+settings.genome,currentState.userDatasets.join(";"),{expires:30})))}}))}function updateResultsAndDocuments(a,b){if(a||b){var c=getQuery(" ","Eregion","main");nh=0;a&&(nh=10);answerQuery(currentState.exploreRegionSelected,c,0,nh,!0,"",function(c){a&&updateResults(c);b&&updateNumberOfDocuments(c)})}}
function updateOpenFeature(a,b,c){showInfoPlot("nodescription");$(".infoboxRegions").hide();$("#openedFeatureResults tr").remove();$("#openedFeatureResults div.featureRangeOrRatioResults").remove();$("#openedFeatureResults").append($('<div class="featureRangeOrRatioResults"></div>'));b&&$(".featureBoxOpened").each(function(){var a=$(this).children("input:hidden"),c=a[0].value;if(void 0!==currentState.featuresElements[c])currentState.featureCurrentVisualization=c,$("#currentLinkLocation").text("");
var d=a[1].value,g=[c];"featureRange"==d||"featureRatio"==d||"featureNeighborhood"==d?(g.push(a[2].value),g.push(a[3].value)):"featureTable"==d?(g.push(a[2].value),g.push(a[3].value),g.push(a[4].value),g.push(!0)):"featureTable"==d&&(g=["Eregion"]);var a=currentState.exploreRegionSelected,c="featureTable"!=d?"-"==c.charAt(0)?getQuery(" ",c.substr(1)+"*","main"):getQuery(" ",c+"*","main"):getQueryComplexJoin(" ","Eregion",g[1],g[2],g[3]),i=0,h=0,k="";b&&("featureText"==d?(i=40,k="rw=3a"):"featureRange"==
d?i=1E3:"featureRatio"==d?i=1E3:"featureNeighborhood"==d?i=1500:"featureTable"==d?g[0].startsWith("GENENAME")?h=200:g[0].startsWith("GO:ALL")?(i=100,k="rw=1d"):g[0].startsWith("GO:TERMS")?i=200:g[0].startsWith("OMIM:ALL")?(i=100,k="rw=1d"):g[0].startsWith("OMIM:TERMS")&&(i=200):"featureRegionsList"==d&&(i=300,h=200));updateOpenedFeatureCore(d,a,c,i,h,k,g)});updateResultsAndDocuments(a,c)}
function updateOpenedFeatureCore(a,b,c,f,e,d,g){answerQuery(b,c,f,e,!0,d,function(b){"featureText"==a?updateOpenedFeatureTable(b,g):"featureRange"==a?updateOpenedFeatureRange(b,g):"featureRatio"==a?updateOpenedFeatureRatio(b,g):"featureNeighborhood"==a?updateOpenedFeatureNeighborhood(b,g):"featureRegionsList"==a?updateOpenedFeatureRegionsList(b,g):"featureTable"==a&&updateOpenedFeatureJTable(b,g)})}
function updateResults(a){$(".progress_image_hits").remove();var b=0;$.each(a[4],function(a){b+=1;var a=a.split("_"),f="http://genome.ucsc.edu/cgi-bin/hgTracks?db="+settings.genome+"&position="+a[a.length-3]+"%3A"+a[a.length-2]+"-"+a[a.length-1];$("#resultsHitsListing > p").append($('<a href="'+f+'" target="_blank">'+a[a.length-3]+" "+a[a.length-2]+" "+a[a.length-1]+"</a><br>"))});10>b?$("#resultsHitsListing > p").prepend($("<h4>All "+b+" results</h4>")):($("#resultsHitsListing > p").prepend($("<h4>First 10 results</h4>")),
a=$('<div class="exportRegionsButton">Export all</div>'),a.button(),$("#resultsHitsListing > p").append(a))}
function updateCurrentSelectionOverlapPlotOnlyPlotGoogle(){var a={cols:[{label:"Annotation",type:"string"}],rows:[]},b=800,c=10;12<currentState.overlapSelection.length&&(c=9,b=1E3);var f;f=""==currentState.featureCurrentVisualization||currentState.featureCurrentVisualization==settings.genome+"summary"?"Summary of "+numberWithCommas(currentState.totalNumberOfRegions)+" "+currentState.datasetInfo[currentState.exploreRegionSelected].officialName:getTextForFeatureGroup(currentState.featureCurrentVisualization)+
" summary of "+numberWithCommas(currentState.totalNumberOfRegions)+" "+currentState.datasetInfo[currentState.exploreRegionSelected].officialName;b={width:b,height:350,title:f,legend:"top",hAxis:{maxAlternation:1,textStyle:{fontName:"Tahoma",fontSize:c},slantedText:!1,slantedTextAngle:10,showTextEvery:1},vAxis:{title:"Percent of overlapping regions",titleTextStyle:{italic:!1},format:"#,###%",minValue:0,maxValue:1},chartArea:{left:60,width:b-60}};""!=currentState.referenceQuery.genome?(a.cols.push({label:"Current selection ("+
numberWithCommas(currentState.totalNumberOfRegions)+")",type:"number"}),a.cols.push({label:"Reference ("+numberWithCommas(currentState.referenceQuery.totalNumber)+")",type:"number"}),b.colors=["#FA9627","#999999"]):(a.cols.push({label:"Current selection",type:"number"}),b.legend="none",b.colors=["#FA9627"]);var e=[];$.each(currentState.overlapSelection,function(b,c){e.push(c);var d=c.replace(/OVERLAP/g,settings.overlap).replace(/TISSUE/g,settings.tissue);if(void 0!=overlapLabels[d]){row=[];row.push({v:overlapLabels[d]});
if(void 0!==currentState.currentOverlaps[d]){var f=currentState.currentOverlaps[d]/currentState.totalNumberOfRegions;row.push({v:f,f:numberWithCommas(currentState.currentOverlaps[d])+" ("+Math.round(1E3*f)/10+"%)"})}else row.push({v:0,f:0});""!=currentState.referenceQuery.genome&&(void 0!==currentState.referenceQuery.values[d]?(f=currentState.referenceQuery.values[d]/currentState.referenceQuery.totalNumber,row.push({v:f,f:numberWithCommas(currentState.referenceQuery.values[d])+" ("+Math.round(1E3*
f)/10+"%)"})):row.push({v:0,f:0}));a.rows.push({c:row})}});var c=new google.visualization.DataTable(a,0.6),d=new google.visualization.ChartWrapper({chartType:"ColumnChart",containerId:"rangeFeaturePlot",dataTable:c,options:b});d.draw();google.visualization.events.addListener(d,"select",function(){if(!1!=currentState.isRegionSelected)for(var a=d.getChart().getSelection(),b=0;b<a.length;b++)if(null!=a[b].row){var c=getForwardVisualizationID(currentState.featureCurrentVisualization,e[a[b].row]);loadVisualizationByID(c)}});
c=$('<tr class="showTableLink"><td colspan="2"><a href="#" onclick="return false">Show as table</a></td></tr>');c.click(function(){"Table"==d.getChartType()?(d.setChartType("ColumnChart"),d.setOption("height",350),$(".showTableLink a").text("Show as table"),$("tr.toPNGRow").show()):(d.setChartType("Table"),d.setOption("height",null),$(".showTableLink a").text("Show as chart"),$("tr.toPNGRow").hide());d.draw()});$(".showTableLink").remove();$("#rangeFeaturePlotTable").append(c);$("tr.toPNGRow").remove();
b=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+b.width+'"/> <input type="hidden" value="'+b.height+'"/><input type="hidden" value="'+d.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlotTable").append(b)}
function updateCurrentSelectionOverlapPlot(a){var b=currentState.featureCurrentVisualization;closeOpenFeatureBox();currentState.featureCurrentVisualization=b;showInfoPlot("summary");""==currentState.featureCurrentVisualization||currentState.featureCurrentVisualization==settings.genome+"summary"?$(".infoboxRegions").show():$(".infoboxRegions").hide();$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr><td colspan="2"><div id="rangeFeaturePlot"></div></td></tr></table>'));
-1<currentState.overlapSelection.join("_").search("OVERLAP")&&($("#rangeFeaturePlotTable").append('<tr><td>Select overlap criterion:</td><td><select id="overlapSelect"><option value="Eoverlaps">Any overlap (at least 1bp)</option><option value="Eoverlaps10p">Medium overlap (at least 10%)</option><option value="Eoverlaps50p">Strong overlap (at least 50%)</option></select></td></tr>'),$("#overlapSelect").val(settings.overlap));-1<currentState.overlapSelection.join("_").search("TISSUE")&&($("#rangeFeaturePlotTable").append('<tr><td>Select tissue:</td><td><select id="tissueSelect"></select></td></tr>'),
$.each(settings.defaultTissues,function(a,b){$("#tissueSelect").append($('<option value="'+b+'">'+getTissueDescription(b)+"</option>"))}),$("#tissueSelect").val(settings.tissue));a||currentState.currentOverlaps==settings.defaultCurrentOverlaps?(a=currentState.exploreRegionSelected,b=getQuery(" ","Eregion","main"),answerQuery(a,b,0,0,!0,"",updateNumberOfDocuments),b=getQuery(" ",settings.overlap+":*","main"),$(".visualization").append($('<img name="progress_image_feature_plot" src="extras/ajax-loader-big.gif" class="progress_image_feature_plot" align="center"></img>')),
answerQuery(a,b,settings.maxOverlapCompletions,0,!0,"",function(a){currentState.currentOverlaps={};totalNumber=parseInt(a[2],10);$.each(a[3],function(a,b){b=parseInt(b,10);currentState.currentOverlaps[a]=b});""!=currentState.referenceQuery.genome?(referenceQuery=currentState.referenceQuery.query.replace(/BASEREFQUERY/g,settings.overlap+":*"),answerQuery(currentState.referenceQuery.dataset,referenceQuery,1500,0,!0,"",function(a){$.each(a[3],function(a,b){b=parseInt(b,10);currentState.referenceQuery.values[a]=
b});updateCurrentSelectionOverlapPlotOnlyPlotGoogle();$(".progress_image_feature_plot").remove()})):(updateCurrentSelectionOverlapPlotOnlyPlotGoogle(),$(".progress_image_feature_plot").remove())})):updateCurrentSelectionOverlapPlotOnlyPlotGoogle()}
function updateOpenedFeatureNeighborhood(a,b){var c={},f={},e={};$.each(a[3],function(a,b){var d=a.split(":");void 0==c[d[4]]&&(c[d[4]]={});void 0==c[d[4]][d[3]]&&(c[d[4]][d[3]]={});c[d[4]][d[3]][d[2]]=[b,0];f[d[2]]=!0;e[d[3]]=!0});""!=currentState.referenceQuery.genome&&(referenceQuery=currentState.referenceQuery.query.replace(/BASEREFQUERY/g,b[0]+"*"),answerQuery(currentState.referenceQuery.dataset,referenceQuery,1500,0,!1,"",function(a){$.each(a[3],function(a,b){var d=a.split(":");void 0==c[d[4]]&&
(c[d[4]]={});void 0==c[d[4]][d[3]]&&(c[d[4]][d[3]]={});c[d[4]][d[3]][d[2]]=void 0!==c[d[4]][d[3]][d[2]]?[c[d[4]][d[3]][d[2]][0],b]:[0,b];f[d[2]]=!0;e[d[3]]=!0})}));var d=[];$.each(f,function(a){d.push(a)});var g=[];$.each(e,function(a){g.push(a)});g.sort();var i="",h=[],k=[],j={},l=0,m=[];$.each(b[1].split(":"),function(a,b){m.push("0".repeat(6-b.length)+b)});m.sort();m.reverse();$.each(m,function(a,b){var c=parseInt(b,10);k.push("start - "+parseInt(c,10));j["bs"+c]=l;l+=1});var r=b[2].split(":"),
r=[];$.each(b[2].split(":"),function(a,b){r.push("0".repeat(6-b.length)+b)});r.sort();$.each(r,function(a,b){var c=parseInt(b,10);k.push("end + "+c);j["ae"+c]=l;l+=1});if(!(1<d.length)){var n=d[0],i=n+" neighborhood for "+currentState.datasetInfo[currentState.exploreRegionSelected].officialName;$.each(k,function(a,b){var c=[{v:b}];$.each(g,function(){c.push({v:0,f:"0 cases"})});""!=currentState.referenceQuery.genome&&$.each(g,function(){c.push({v:0,f:"0 cases"})});h.push({c:c})});$.each(c,function(a,
b){$.each(g,function(c,d){if(void 0!==b[d])if(void 0!==b[d][n]){var e=parseInt(b[d][n][0],10);h[j[a]].c[c+1]={v:e/currentState.totalNumberOfRegions,f:e+" cases"}}else alert("No histone mark "+n+" data for tissue "+d)});""!=currentState.referenceQuery.genome&&$.each(g,function(c,d){if(void 0!==b[d])if(void 0!==b[d][n]){var e=parseInt(b[d][n][1],10);h[j[a]].c[g.length+c+1]={v:e/currentState.referenceQuery.totalNumber,f:e+" cases"}}else alert("No histone mark "+n+" data for tissue "+d)})})}""==currentState.referenceQuery.genome?
updateOpenedFeatureNeighborhoodGooglePlotSingle(i,h,g):updateOpenedFeatureNeighborhoodGooglePlotReference(i,h,g);$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureNeighborhoodGooglePlotReference(a,b,c){function f(d){var e=[{type:"string",label:"Position relative to the "+currentState.datasetInfo[currentState.exploreRegionSelected].officialName},{type:"number",label:c[d]+" (Current selection "+numberWithCommas(currentState.totalNumberOfRegions)+")"},{type:"number",label:c[d]+" (Reference "+numberWithCommas(currentState.referenceQuery.totalNumber)+")"}],f=[];$.each(b,function(a,b){f.push({c:[b.c[0],b.c[d+1],b.c[c.length+d+1]]})});
var i=new google.visualization.DataTable({cols:e,rows:f},0.6),e={title:a,width:750,legend:"top",height:g,vAxis:{title:"Percent of cases",titleTextStyle:{italic:!1},format:"###.##%"},pointSize:5,hAxis:{title:"Relative position",titleTextStyle:{italic:!1},showTextEvery:1,slantedText:1,slantedTextAngle:20},chartArea:{left:60,width:690},colors:["#FA9627","#999999"]};h=new google.visualization.ChartWrapper({chartType:"LineChart",containerId:"rangeFeaturePlot",dataTable:i,options:e});h.draw();i=$('<tr class="showTableLink"><td></td><td ><a href="#" onclick="return false">Show as table</a></td></tr>');
i.click(function(){"Table"==h.getChartType()?(h.setChartType("LineChart"),h.setOption("height",g),$(".showTableLink a").text("Show as table"),$("tr.toPNGRow").show()):(h.setChartType("Table"),h.setOption("height",null),$(".showTableLink a").text("Show as chart"),$("tr.toPNGRow").hide());h.draw()});$(".showTableLink").remove();$("#rangeFeaturePlotTable").append(i);$("tr.toPNGRow").remove();e=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+
e.width+'"/> <input type="hidden" value="'+e.height+'"/><input type="hidden" value="'+h.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlotTable").append(e)}$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("neighborhoodref");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr><td><div id="neighborhoodReferencetissueSelectionTable"></div></td><td><div id="rangeFeaturePlot"></div></td></tr></table>'));var e=[];$.each(c,function(a,
b){e.push({c:[{v:b}]})});var d=new google.visualization.DataTable({cols:[{label:"Select tissue",type:"string"}],rows:e},0.6),g=400,i=new google.visualization.ChartWrapper({chartType:"Table",containerId:"neighborhoodReferencetissueSelectionTable",dataTable:d,options:{width:100,height:g}});i.draw();var h;f(0);google.visualization.events.addListener(i,"select",function(){var a=i.getChart().getSelection()[0];null!=a.row&&f(a.row)})}
function updateOpenedFeatureNeighborhoodGooglePlotSingle(a,b,c){$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("neighborhoodsingle");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr><td colspan="2"><div id="rangeFeaturePlot"></div></td></tr></table>'));var f=[];f.push({type:"string",label:"Position relative to the "+currentState.datasetInfo[currentState.exploreRegionSelected].officialName});$.each(c,function(a,b){f.push({type:"number",
label:b})});var e=new google.visualization.DataTable({cols:f,rows:b},0.6),d={title:a,width:800,height:400,legend:"top",vAxis:{title:"Percent of cases",titleTextStyle:{italic:!1},format:"###.##%"},pointSize:5,hAxis:{title:"Relative position",titleTextStyle:{italic:!1},showTextEvery:1,slantedText:1,slantedTextAngle:20},chartArea:{left:60,width:740}},g=new google.visualization.ChartWrapper({chartType:"LineChart",containerId:"rangeFeaturePlot",dataTable:e,options:d});google.visualization.events.addListener(g,
"select",function(){var a=g.getChart().getSelection()[0];null!=a.column&&(e.removeColumn(a.column),g.draw(e,d))});g.draw();a=$('<tr class="showTableLink"><td ><a href="#" onclick="return false">Show as table</a></td><td></td></tr>');a.click(function(){"Table"==g.getChartType()?(g.setChartType("LineChart"),g.setOption("height",400),$(".showTableLink a").text("Show as table"),$("tr.toPNGRow").show()):(g.setChartType("Table"),g.setOption("height",null),$(".showTableLink a").text("Show as chart"),$("tr.toPNGRow").hide());
g.draw()});$(".showTableLink").remove();$("#rangeFeaturePlotTable").append(a);$("tr.toPNGRow").remove();a=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+d.width+'"/> <input type="hidden" value="'+d.height+'"/><input type="hidden" value="'+g.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlotTable").append(a)}
function updateOpenedFeatureRatio(a,b){updateOpenedFeatureRatioLines(a,b);$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureRatioLines(a,b){var c=function(a){return convertRatioToNumber(a,b[1])},f=[],e={},d=Math.pow(10,b[1]),g=0;$.each(a[3],function(a,b){var c=parseInt(b,10),i=a.split(":").pop(),h=parseInt(i,10);d>h&&(d=h);g<h&&(g=h);f[h]=c;e[i]=[c,0]});var i=d,h=g;""!=currentState.referenceQuery.genome&&(referenceQuery=currentState.referenceQuery.query.replace(/BASEREFQUERY/g,b[0]+"*"),answerQuery(currentState.referenceQuery.dataset,referenceQuery,1500,0,!1,"",function(a){$.each(a[3],function(a,
b){var d=parseInt(b,10),f=a.split(":").pop(),g=parseInt(f,10);i>g&&(i=g);h<g&&(h=g);c(g);currentState.referenceQuery.values[g]=d;e[f]=void 0!==e[f]?[e[f][0],d]:[0,d]})}));if(0<f.length)1==f.length||d==g?updateOpenedFeatureTableLines(a,"",b,!1):updateOpenedFeatureRatioSlider(f,d,g,c,b),updateOpenedFeatureRatioPlotGoogle(e,c,b);else{$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr style="width:100%;"><td align="left">No regions fit this query</td><td></td></tr></table>'));
var k=$('<tr style="width:100%;"><td ></td><td align="left">No regions fit this query</td><td align="right"></td></tr>');$("#openedFeatureResults").append(k)}}
function updateOpenedFeatureRatioPlotGoogle(a,b,c){$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("ratio");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr><td colspan="2"><div id="rangeFeaturePlot"></div></td></tr></table>'));var f={cols:[{label:"ORatio",type:"string"},{label:"Current selection",type:"number"}],rows:[]},e=Object.keys(a);e.sort();var d=null,g=0,i=0;$.each(e,function(c,e){var h=parseInt(e,10),k=b(h),j=a[e];if(null!=
d&&h>d+1)for(var l=d+1;l<h;l++){var q=b(l);""!=currentState.referenceQuery.genome?f.rows.push({c:[{v:q},{v:0,f:"0 cases"},{v:0,f:"0 cases"}]}):f.rows.push({c:[{v:q},{v:0,f:"0 cases"}]})}d=h;b(h+1);h={v:0};null!=j[0]&&(h={v:j[0]/currentState.totalNumberOfRegions,f:j[0]+" cases"},g+=parseInt(j[0],10));""!=currentState.referenceQuery.genome?(l={v:0},null!=j[1]&&(l={v:j[1]/currentState.referenceQuery.totalNumber,f:j[1]+" cases"},i+=parseInt(j[1],10)),f.rows.push({c:[{v:k},h,l]})):f.rows.push({c:[{v:k},
h]})});e={width:850,height:400,chartArea:{left:60,width:740,right:50},hAxis:{title:getTextForFeaturePrefix(c[0]),titleTextStyle:{italic:!1}},vAxis:{title:"Percent of cases",titleTextStyle:{italic:!1},format:"###.##%",viewWindowMode:"pretty"},pointSize:6};""!=currentState.referenceQuery.genome?(f.cols.push({label:"Reference",type:"number"}),e.legend="top",e.colors=["#FA9627","#999999"]):(e.legend="none",e.colors=["#AAAAAA"]);var h=new google.visualization.DataTable(f,0.6);e.hAxis.showTextEvery=Math.round(f.rows.length/
10);e.hAxis.maxAlternation=1;e.hAxis.textStyle={fontSize:10};e.hAxis.slantedText=!1;e.pointSize=1;var k=new google.visualization.ChartWrapper({chartType:"AreaChart",containerId:"rangeFeaturePlot",dataTable:h,options:e});k.draw();if(c[0].startsWith("Eor:")||c[0].startsWith("Emeth")){h=Math.round(100*g/currentState.totalNumberOfRegions);if(""!=currentState.referenceQuery.genome){var j=Math.round(100*i/currentState.referenceQuery.totalNumber);if(c[0].startsWith("Eor:"))var l=$('<tr class="noteShowRow"><td><i>Note: the visualization reports only data for the '+
numberWithCommas(g)+" ("+h+"%) overlapping regions from the current selection and "+numberWithCommas(i)+" ("+j+"%) reference regions</i></td><td></td></tr>");else c[0].startsWith("Emeth")&&(l=$('<tr class="noteShowRow"><td><i>Note: the visualization reports only data for the '+numberWithCommas(g)+" ("+h+"%) current selection regions  and "+numberWithCommas(i)+" ("+j+"%) reference regions for which methylation data is available</i></td><td></td></tr>"))}else c[0].startsWith("Eor:")?l=$('<tr class="noteShowRow"><td><i>Note: the visualization reports only data for the '+
numberWithCommas(g)+" ("+h+"%) overlapping regions</i></td><td></td></tr>"):c[0].startsWith("Emeth")&&(l=$('<tr class="noteShowRow"><td><i>Note: the visualization reports only data for the '+numberWithCommas(g)+" ("+h+"%) regions for which methylation data is available</i></td><td></td></tr>"));$(".noteShowRow").remove();$("#rangeFeaturePlotTable").append(l)}c=$('<tr class="showTableLink"><td ><a href="#" onclick="return false">Show as table</a></td><td></td></tr>');c.click(function(){"Table"==k.getChartType()?
(k.setChartType("AreaChart"),k.setOption("height",400),$(".showTableLink a").text("Show as table"),$("tr.toPNGRow").show()):(k.setChartType("Table"),k.setOption("height",null),$(".showTableLink a").text("Show as chart"),$("tr.toPNGRow").hide());k.draw()});$(".showTableLink").remove();$("#rangeFeaturePlotTable").append(c);$("tr.toPNGRow").remove();c=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+e.width+'"/> <input type="hidden" value="'+
e.height+'"/><input type="hidden" value="'+k.getContainerId()+'"/></td><td></td></tr>');$("#rangeFeaturePlotTable").append(c)}function updateOpenedFeatureRange(a,b){updateOpenedFeatureRangeLines(a,b);$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureRangeLines(a,b){var c=function(a){return convertRangeToNumber(a,b[1],b[2])},f=[],e={},d={},g={},i={},h=1E3,k=0;$.each(a[3],function(a,i){var j=parseInt(i,10),l=a.split(":").pop(),p=parseInt(l,10);if(void 0!==g[l[0]])g[l[0]][1]+=j;else{var n=l[0]+"1"+"0".repeat(b[1]-2),m=parseInt(l[0])+1+"1"+"0".repeat(b[1]-2),n="Between "+numberWithCommas(c(n))+" and "+numberWithCommas(c(m));g[l[0]]=[n,j];d[n]=[]}h>p&&(h=p);k<p&&(k=p);f[p]=j;e[l]=g[l[0]][0]});var j=parseInt(a[2],10);currentState.totalNumberOfRegions>
j&&(g.OVERLAP=["Overlapping",currentState.totalNumberOfRegions-j]);var l=1;""!=currentState.referenceQuery.genome&&($.each(g,function(a,b){b.push(0);g[a]=b}),referenceQuery=currentState.referenceQuery.query.replace(/BASEREFQUERY/g,b[0]+"*"),answerQuery(currentState.referenceQuery.dataset,referenceQuery,1500,0,!1,"",function(a){$.each(a[3],function(a,f){var i=parseInt(f,10),h=a.split(":").pop(),k=parseInt(h,10);if(void 0!==g[h[0]])g[h[0]][2]+=i;else{var j=h[0]+"1"+"0".repeat(b[1]-2),l=h[0]+"9".repeat(b[1]-
1),j="Between "+numberWithCommas(c(j))+" and "+numberWithCommas(c(l));g[h[0]]=[j,0,i];d[j]=[]}currentState.referenceQuery.values[k]=i;e[h]=g[h[0]][0]});l=parseInt(a[2],10);if(currentState.totalNumberOfRegions>j||currentState.referenceQuery.totalNumber>l)g.OVERLAP=["Overlapping",currentState.totalNumberOfRegions-j,currentState.referenceQuery.totalNumber-l];i={cols:[{label:"Range",type:"string"}],rows:[{c:[{v:"Current selection ("+currentState.totalNumberOfRegions+")"}]},{c:[{v:"Reference ("+currentState.referenceQuery.totalNumber+
")"}]}]};a=Object.keys(g);a.sort();$.each(a,function(a,b){var c=g[b];i.cols.push({label:c[0]+"",type:"number",id:b[0]+""});i.rows[0].c.push({v:c[1]/currentState.totalNumberOfRegions,f:c[1]+""});i.rows[1].c.push({v:c[2]/currentState.referenceQuery.totalNumber,f:c[2]+""})})}));var m=Object.keys(e);m.sort();var r=null,n=0;$.each(m,function(a,b){var g=parseInt(b,10),i=e[b];if(i==r&&n+1<g)for(var h=n+1,h=n+1;h<g;h++){var j=c(h);""!=currentState.referenceQuery.genome?d[i].push([{v:j+""},0,0]):d[i].push([{v:j+
""},0])}r=i;n=g;h=c(parseInt(g,10));c(parseInt(g,10)+1);if(""!=currentState.referenceQuery.genome){j=0;void 0!==f[g]&&(j={v:f[g]/currentState.totalNumberOfRegions,f:f[g]+" cases"});var k=0;void 0!==currentState.referenceQuery.values[g]&&(k={v:currentState.referenceQuery.values[g]/currentState.referenceQuery.totalNumber,f:currentState.referenceQuery.values[g]+" cases"});d[i].push([{v:h+""},j,k])}else j=0,void 0!==f[g]&&(j={v:parseInt(f[g],10)/currentState.totalNumberOfRegions,f:f[g]+" cases"}),d[i].push([{v:h+
""},j])});if(0<f.length)if(h==k?updateOpenedFeatureTableLines(a,"",b,!1):updateOpenedFeatureRangeSlider(f,h,k,c,b),""!=currentState.referenceQuery.genome)updateOpenedFeatureRangePlotColumn(i,d,b,c);else{var s=[],m=Object.keys(g);m.sort();$.each(m,function(a,b){s.push(g[b])});updateOpenedFeatureRangePlotPie(s,d,b,c)}else $("#rangeFeaturePlotMain").children().remove(),$("#rangeFeaturePlotMain").show(),$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr style="width:100%;"><td align="left">No regions fit this query</td><td></td></tr></table>')),
m=$('<tr style="width:100%;"><td ></td><td align="left">No regions fit this query</td><td align="right"></td></tr>'),$("#openedFeatureResults").append(m)}
function updateOpenedFeatureRangePlotColumn(a,b,c){$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("rangecolumn");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlot"><tr><td><div id="rangeFeaturePlotPie" ></div></td><td><div id="rangeFeaturePlotScatter" ></div></td></tr></table>'));var f=new google.visualization.DataTable(a,0.6),a={width:450,height:400,title:getTextForFeaturePrefix(c[0]),isStacked:!0,enableInteractivity:!0,legend:"top",chartArea:{left:50,
width:400},vAxis:{format:"###.##%"},legendTextStyle:{fontSize:9}},e=new google.visualization.ChartWrapper({chartType:"ColumnChart",containerId:"rangeFeaturePlotPie",dataTable:f,options:a});e.draw();google.visualization.events.addListener(e,"select",function(){for(var a=e.getChart().getSelection(),d=0;d<a.length;d++){var g=a[d];null!=g.row&&null!=g.column?message=f.getColumnLabel(g.column):null!=g.row?message="":null!=g.column&&(message=f.getColumnLabel(g.column))}void 0!==b[message]&&updateOpenedFeatureRangePlotGoogle(b[message],
c)});var d=$('<tr class="showTableLink"></tr>'),g=$('<td><a href="#" onclick="return false">Show as table</a></td>');g.click(function(){"Table"==e.getChartType()?(e.setChartType("ColumnChart"),e.setOption("height",400),$(".showTableLink td:eq(0) a").text("Show as table"),$("tr.toPNGRow td:eq(0) ").show()):(e.setChartType("Table"),e.setOption("height",null),$(".showTableLink td:eq(0) a").text("Show as chart"),$("tr.toPNGRow td:eq(0) a").hide());e.draw()});$(".showTableLink").remove();$(d).append(g);
$("#rangeFeaturePlot").append(d);$("tr.toPNGRow").remove();a=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+a.width+'"/> <input type="hidden" value="'+a.height+'"/><input type="hidden" value="'+e.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlot").append(a);updateOpenedFeatureRangePlotGoogle(b[f.getColumnLabel(1)],c)}
function updateOpenedFeatureRangePlotPie(a,b,c){$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("rangepie");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlot"><tr><td><div id="rangeFeaturePlotPie" ></div></td><td><div id="rangeFeaturePlotScatter" ></div></td></tr></table>'));var f=new google.visualization.DataTable;f.addColumn("string","Range");f.addColumn("number","Number fo regions");f.addRows(a);var e={width:450,height:400,title:getTextForFeaturePrefix(c[0]),
legend:"right",sliceVisibilityThreshold:1.0E-4,chartArea:{left:0,width:450},is3D:!0,legendTextStyle:{fontSize:10}},d=new google.visualization.ChartWrapper({chartType:"PieChart",containerId:"rangeFeaturePlotPie",dataTable:f,options:e});d.draw();google.visualization.events.addListener(d,"select",function(){for(var a=d.getChart().getSelection(),e="",g=0;g<a.length;g++){var i=a[g],e=f.getValue(i.row,0);f.getValue(i.row,1)}void 0!==b[e]&&updateOpenedFeatureRangePlotGoogle(b[e],c)});var g=$('<tr class="showTableLink"></tr>'),
i=$('<td><a href="#" onclick="return false">Show as table</a></td>');i.click(function(){"Table"==d.getChartType()?(d.setChartType("PieChart"),d.setOption("height",400),$("tr.showTableLink td:eq(0) a").text("Show as table"),$("tr.toPNGRow td:eq(0) a").show()):(d.setChartType("Table"),d.setOption("height",null),$("tr.showTableLink td:eq(0) a").text("Show as chart"),$("tr.toPNGRow td:eq(0) a").hide());d.draw()});$(".showTableLink").remove();$(g).append(i);$("#rangeFeaturePlot").append(g);$("tr.toPNGRow").remove();
e=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+e.width+'"/> <input type="hidden" value="'+e.height+'"/><input type="hidden" value="'+d.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlot").append(e);updateOpenedFeatureRangePlotGoogle(b[a[0][0]],c)}
function updateOpenedFeatureRangePlotGoogle(a,b){var c=new google.visualization.DataTable,f={width:500,height:400,chartArea:{left:60,width:400,right:40},vAxis:{title:"Percent of cases",titleTextStyle:{italic:!1},format:"###.##%"},hAxis:{title:getTextForFeaturePrefix(b[0]),titleTextStyle:{italic:!1},showTextEvery:Math.round(a.length/5),textStyle:{fontSize:10},slantedText:!1,maxAlternation:1},pointSize:5};""!=currentState.referenceQuery.genome?(c.addColumn("string","Length"),c.addColumn("number","Current selection"),
c.addColumn("number","Reference"),f.legend="top",f.colors=["#FA9627","#999999"]):(c.addColumn("string","Length"),c.addColumn("number","Current selection"),f.legend="none",f.colors=["#AAAAAA"]);c.addRows(a);var e=new google.visualization.ChartWrapper({chartType:"AreaChart",containerId:"rangeFeaturePlotScatter",dataTable:c,options:f});e.draw();var d=$('<td><a href="#" onclick="return false">Show as table</a></td>');d.click(function(){"Table"==e.getChartType()?(e.setChartType("AreaChart"),e.setOption("height",
400),d.children("a").text("Show as table"),$("tr.toPNGRow td:eq(1) a").show()):(e.setChartType("Table"),e.setOption("height",null),d.children("a").text("Show as chart"),$("tr.toPNGRow td:eq(1) a").hide());e.draw()});$("tr.showTableLink td:gt(0)").remove();$("tr.showTableLink").append(d);$("tr.toPNGRow td:eq(1)").remove();c=$('<td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+f.width+'"/> <input type="hidden" value="'+f.height+'"/><input type="hidden" value="'+
e.getContainerId()+'"/></td>');$("tr.toPNGRow").append(c)}
function updateOpenedFeatureRatioSlider(a,b,c,f,e){var f=$('<div><p id="featureRangeAmount"></p></div>'),d=$("<div></div>");d.slider({range:!0,min:b,max:c,values:[b,c],slide:function(b,c){var d=a.sum(c.values[0],c.values[1]),f=Math.round(100*d/currentState.totalNumberOfRegions);$("#featureRangeAmount").text(getReadableFeatureText(e[0]+c.values[0]+"--"+e[0]+c.values[1])+" for total of "+d+" hits ("+f+"%)")}});f.append(d);d=$('<span title="Filter to this selection" style="margin:5px;">Filter to this selection</span>');d.button();
d.one("click",function(b){b.stopPropagation();var b=parseInt($("#openedFeatureResults .ui-slider").slider("values",0),10),c=parseInt($("#openedFeatureResults .ui-slider").slider("values",1),10),c=a.searchSE(c),b=a.searchLE(b);if(0!=e[2])b="0".repeat(e[2]-(b+"").length)+b,c="0".repeat(e[2]-(c+"").length)+c;else{if(100>b&&(3==e[1]||0==e[1]))b="0"+b;10>b&&(b="0"+b);if(100>c&&(3==e[1]||0==e[1]))c="0"+c;10>c&&(c="0"+c)}b=e[0]+b+"--"+e[0]+c;c=getReadableFeatureText(b);addResultsRefinementAndUpdate(c,b,
-1,!0)});f.append(d);$("#openedFeatureResults div.featureRangeOrRatioResults").append(f);f=a.sum(b,c);d=Math.round(100*f/currentState.totalNumberOfRegions);$("#featureRangeAmount").text(getReadableFeatureText(e[0]+b+"--"+e[0]+c)+" for total of "+f+" hits ("+d+"%)")}
function updateOpenedFeatureRangeSlider(a,b,c,f,e){var f=$('<div><p id="featureRangeAmount"></p></div>'),d=$("<div></div>");d.slider({range:!0,min:b,max:c,values:[b,c],slide:function(b,c){if(c.values[0]==c.values[1])return!1;var d=a.sum(c.values[0],c.values[1]),f=Math.round(100*d/currentState.totalNumberOfRegions);$("#featureRangeAmount").text(getReadableFeatureText(e[0]+c.values[0]+"--"+e[0]+c.values[1])+" for total of "+d+" hits ("+f+"%)")}});f.append(d);d=$('<span title="Filter to this selection" style="margin:5px;">Filter to this selection</span>');
d.button();d.one("click",function(a){a.stopPropagation();a=parseInt($("#openedFeatureResults .ui-slider").slider("values",0),10);100>a&&3==e[1]&&(a="0"+a);10>a&&(a="0"+a);var b=$("#openedFeatureResults .ui-slider").slider("values",1);100>b&&3==e[1]&&(b="0"+b);10>b&&(b="0"+b);a=e[0]+a+"--"+e[0]+b;b=getReadableFeatureText(a);addResultsRefinementAndUpdate(b,a,-1,!0)});f.append(d);$("#openedFeatureResults div.featureRangeOrRatioResults").append(f);f=a.sum(b,c);d=Math.round(100*f/currentState.totalNumberOfRegions);
$("#featureRangeAmount").text(getReadableFeatureText(e[0]+b+"--"+e[0]+c)+" for total of "+f+" hits ("+d+"%)")}function updateOpenedFeatureJTable(a,b){updateOpenedFeatureJTableLines(a,b);$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureJTableLines(a,b){var c=[];parseInt($("#totalDocuments").text().replace(/,/g,""),10);b[0].startsWith("GENENAME:")?c=updateOpenedFeatureJTableLinesGENENAMES(a,b):b[0].startsWith("GO:ALL")?c=updateOpenedFeatureJTableLinesGONAMES(a,b):b[0].startsWith("GO:TERMS")?c=updateOpenedFeatureJTableLinesTERMS(a,b,"selectGOterm",5):b[0].startsWith("OMIM:ALL")?c=updateOpenedFeatureJTableLinesOMIMNAMES(a,b):b[0].startsWith("OMIM:TERMS")&&(c=updateOpenedFeatureJTableLinesTERMS(a,b,"selectOMIMterm",
6));0<c.length?updateOpenedFeatureJTablePlot(a,c,b):(c=$('<tr style="width:100%;"><td ></td><td align="left">No results fit this query</td><td align="right"></td></tr>'),$("#openedFeatureResults tr").remove(),$("#openedFeatureResults").append(c),b[4]?($("#rangeFeaturePlotMain").children().remove(),rangePlot=$('<table id="rangeFeaturePlot"><tr><td><div id="rangeFeaturePlotTable" ></div></td><td><div id="rangeFeaturePlotTableCloud" ></div></td></tr><tr>No results fit this query</tr></table>'),$("#rangeFeaturePlotMain").append(rangePlot)):
(b[0].startsWith("GO:ALL")?$("#rangeFeaturePlot tr:gt(3)").remove():$("#rangeFeaturePlot tr:gt(0)").remove(),$("#rangeFeaturePlot").append($('<tr><td><div id="rangeFeaturePlotTable" ></div></td><td><div id="rangeFeaturePlotTableCloud" ></div></td></tr>')),$("#rangeFeaturePlot").append($('<tr><td colspan="2">No results fit this query</td></tr>'))))}
function updateOpenedFeatureJTableLinesGONAMES(a){var b={};$.each(a[3],function(a,c){b[a.slice(4)]=parseInt(c,10)-1});var c=[];$.ajax({type:"POST",url:"relay.php",async:!1,dataType:"json",data:{type:"getGeneExtraInfo",genome:settings.genome,infoType:"GO",elements:Object.keys(b)},success:function(a){$.each(a[0],function(a,d){var f=d[0],i='<a href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a+'" target="_blank">'+a+"</a>",h=parseInt(d[2],10),k=parseFloat((b[a]/h).toPrecision(3));
c.push([i,b[a],h,f,k,'<div class="CGSicon ui-icon ui-icon-play ui-icon-turnred selectGOName" title="Use this refinement"></div>'])})}});return c}
function updateOpenedFeatureJTableLinesOMIMNAMES(a){var b={};$.each(a[3],function(a,c){b[a.slice(7)]=parseInt(c,10)-1});var c=[],c=[];$.ajax({type:"POST",url:"relay.php",async:!1,dataType:"json",data:{type:"getGeneExtraInfo",genome:settings.genome,infoType:"OMIM",elements:Object.keys(b)},success:function(a){$.each(a[0],function(a,d){var f=d[0],i='<a href="http://www.ncbi.nlm.nih.gov/omim/'+a+'" target="_blank">OMIM ID:'+a+"</a>",h=parseInt(d[1],10),k=parseFloat((b[a]/h).toPrecision(3));c.push([i,
b[a],h,f,k,'<div class="CGSicon ui-icon ui-icon-play ui-icon-turnred selectOMIMName" title="Use this refinement"></div>'])})}});return c}
function updateOpenedFeatureJTableLinesGENENAMES(a){var b=[];$.each(a[4],function(a){var a=a.split(" "),f='<a href="http://may2009.archive.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g='+a[1]+'" target="_blank">'+a[1]+"</a>",e=a.slice(3).join(" "),d=e.indexOf("[Source:"),e=-1<d?'<p title="'+e.substring(d)+'">'+e.substring(0,d)+"</p>":e;b.push([f,a[2],e,'<div class="CGSicon ui-icon ui-icon-play ui-icon-turnred selectGeneName" title="Use this refinement"></div>'])});return b}
function termConvert(a){return a.replace(/l/g,"+").replace(/d/g,"-").replace(/u/g,"_").replace(/r/g,"i")}function updateOpenedFeatureJTableLinesTERMS(a,b,c,f){var e=[];$.each(a[3],function(a,b){var i='<div class="CGSicon ui-icon ui-icon-play ui-icon-turnred '+c+'" title="Use this refinement"><input type="hidden" value="'+a+'"/>';e.push([termConvert(a.slice(f)).toLowerCase(),parseInt(b,10),i])});return e}
function updateOpenedFeatureJTablePlot(a,b,c){$("#openedFeatureResults tr").remove();var f;c[4]?($("#rangeFeaturePlotMain").children().remove(),f=$('<table id="rangeFeaturePlot"><tr><td style="vertical-align:top;"><div id="rangeFeaturePlotTable" ></div></td><td><div id="rangeFeaturePlotTableCloud" ></div></td></tr></table>'),$("#rangeFeaturePlotMain").append(f)):(c[0].startsWith("GO:ALL")?$("#rangeFeaturePlot tr:gt(4)").remove():$("#rangeFeaturePlot tr:gt(1)").remove(),f=$("#rangeFeaturePlot"));a[0]=
a[0].replace(/#/g,"%23");var e=a[0].replace(/ /g,"::qq::"),d=new google.visualization.DataTable;c[0].startsWith("GENENAME:")?(d.addColumn("string","Ensembl ID"),d.addColumn("string","Gene symbol"),d.addColumn("string","Description"),d.addColumn("string","")):c[0].startsWith("GO:ALL")?(d.addColumn("string","GO"),d.addColumn("number","Number of regions"),d.addColumn("number","Number of genes"),d.addColumn("string","description"),d.addColumn("number","Ratio"),d.addColumn("string","")):c[0].startsWith("GO:TERMS")?
(d.addColumn("string","Word"),d.addColumn("number","Number of GOs with such description"),d.addColumn("string","")):c[0].startsWith("OMIM:ALL")?(d.addColumn("string","OMIM"),d.addColumn("number","Number of regions"),d.addColumn("number","Number of genes"),d.addColumn("string","description"),d.addColumn("number","Ratio"),d.addColumn("string","")):c[0].startsWith("OMIM:TERMS")&&(d.addColumn("string","Word"),d.addColumn("number","Number of OMIMs with such description"),d.addColumn("string",""));d.addRows(b);
var g={page:"enable",height:null,pageSize:10,pagingButtonsConfiguration:"auto",sortColumn:1,sortAscending:!1,showRowNumber:!0,allowHtml:!0},i=new google.visualization.ChartWrapper({chartType:"Table",containerId:"rangeFeaturePlotTable",dataTable:d,options:g});i.draw();var h,k="Search here:";if(c[0].startsWith("GENENAME:")){k="Search gene symbols";h=$('<td colspan="2"> Showing info for '+b.length+" genes out of "+a[2]+" </td>");if("enable"==g.page&&10<b.length){var j=$(' <a href="#" onclick="return false"> (Show all '+
b.length+") </a> ");j.click(function(){i.setOption("page",null);i.setOption("height","500px");i.draw();$(this).remove()});h.append(j)}j=!1;$("#rangeFeaturePlotTableCloud").children().remove();$("#rangeFeaturePlotTableCloud").append($('<a href="relay.php?type=exportGenesAndSendBack&exportType=TABLE&regiontype='+currentState.exploreRegionSelected+"&query="+e+'" target="_blank"> Export all as table</a><br><br>'));$("#rangeFeaturePlotTableCloud").append($('<a href="relay.php?type=exportGenesAndSendBack&exportType=ENSEMBL&regiontype='+
currentState.exploreRegionSelected+"&query="+e+'" target="_blank"> Export all Ensembl identfiers</a><br><br>'));$("#rangeFeaturePlotTableCloud").append($('<a href="relay.php?type=exportGenesAndSendBack&exportType=SYMBOL&regiontype='+currentState.exploreRegionSelected+"&query="+e+'" target="_blank"> Export all gene symbols</a><br><br>'));e=$("<tr></tr>");e.append(h);f.append(e);h=autoCompleteCallbackGene;showInfoPlot("genes")}else c[0].startsWith("GO:ALL")?(k="Search GO descriptions",j=new TermCloud(document.getElementById("rangeFeaturePlotTableCloud")),
j.draw(d,{numberColumnIndex:4,wordColumnIndex:3,linkColumnIndex:0,target:"_blank"}),h=$('<td colspan="2">Showing top '+b.length+" GOs (by number of regions) out of "+numberWithCommas(a[1])+" </td>"),"enable"==g.page&&10<b.length&&(j=$(' <a href="#" onclick="return false"> (Show all '+b.length+") </a> "),j.click(function(){i.setOption("page",null);i.setOption("height","500px");i.draw();$(this).remove()}),h.append(j)),j=$(' <a href="relay.php?type=exportGOsAndSendBack&regiontype='+currentState.exploreRegionSelected+
"&query="+e+'" target="_blank">Export all</a> '),e=$("<tr></tr>"),e.append(h),f.append(e),c[4]&&(h=getQueryComplexJoin(" ","Eregion","gGONG:*","gGO:*","GOterm gGONG:000--gGONG:999"),answerQuery(currentState.exploreRegionSelected,h,1E3,0,!1,"rw=3a",function(a){var b=[],c=999,d=0;$.each(a[3],function(a,e){var e=parseInt(e,10),f=parseInt(a.slice(6),10);b[f]=e;c>f&&(c=f);d<f&&(d=f)});if(0<b.length&&c<d){var a=function(){var a=$("select.minGenesOFGO option:selected").val(),b=$("select.maxGenesOFGO option:selected").val();
if(a>b)return alert("The minimum value cannot be smaller than the maximum value"),$("select.minGenesOFGO").val("001"),$("select.maxGenesOFGO").val("450"),!1;$("#exampleAutocomplete").val("");a=["GO:ALL:","","gGO:*","GOterm gGONG:"+a+"--gGONG:"+b,!1];b=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",currentState.exploreRegionSelected,b,100,0,"rw=1d",a)},e=$("<tr></tr>"),g=$("<td></td>"),h=$("<table></table>"),i=$("<tr></tr>"),j=$('<td style="padding-left:0px"><label>Exclude GO terms matching less than N genes</label></td>');
e.append(g);g.append(h);h.append(i);i.append(j);j=$('<td style="padding-left:0px"></td>');g=$('<select class="minGenesOFGO"></select>');j.append(g);i.append(j);g.append($('<option value="001" selected="selected">1 (Min)</option>'));g.append($('<option value="005">5</option>'));g.append($('<option value="110">10</option>'));g.append($('<option value="150">50</option>'));g.append($('<option value="210">100</option>'));g.append($('<option value="250">500</option>'));g.append($('<option value="310">1,000</option>'));
g.append($('<option value="350">5,000</option>'));g.append($('<option value="450">Max</option>'));j=$('<td style="padding-left:0px"><label>Exclude GO terms matching more than N genes</label></td>');i=$("<tr></tr>");h.append(i);i.append(j);h=$('<td style="padding-left:0px"></td>');j=$('<select class="maxGenesOFGO"></select>');h.append(j);i.append(h);j.append($('<option value="001">1 (min)</option>'));j.append($('<option value="005">5</option>'));j.append($('<option value="110">10</option>'));j.append($('<option value="150">50</option>'));
j.append($('<option value="210">110</option>'));j.append($('<option value="250">510</option>'));j.append($('<option value="310">1,100</option>'));j.append($('<option value="350">5,100</option>'));j.append($('<option value="450" selected="selected">30,000 (Max)</option>'));e.append($("<td/>"));f.prepend(e);$(g).change(a);$(j).change(a)}})),h=autoCompleteCallbackGOcategory,showInfoPlot("goterms")):c[0].startsWith("GO:TERMS")?(k="Search words in GO terms",j=new TermCloud(document.getElementById("rangeFeaturePlotTableCloud")),
j.draw(d,null),h=$('<td colspan="2">Showing the '+b.length+" most common words from the "+a[2]+" GO terms </td>"),"enable"==g.page&&10<b.length&&(j=$(' <a href="#" onclick="return false"> (Show all '+b.length+") </a> "),j.click(function(){i.setOption("page",null);i.setOption("height","500px");i.draw();$(this).remove()}),h.append(j)),j=$('<a href="relay.php?type=exportGOTermsAndSendBack&regiontype='+currentState.exploreRegionSelected+"&query="+e+'" target="_blank"> Export all </a>'),e=$("<tr></tr>"),
e.append(h),f.append(e),h=autoCompleteCallbackGOterm,showInfoPlot("gowords")):c[0].startsWith("OMIM:ALL")?(k="Search OMIM descriptions",j=new TermCloud(document.getElementById("rangeFeaturePlotTableCloud")),j.draw(d,{numberColumnIndex:4,wordColumnIndex:3,linkColumnIndex:0,target:"_blank"}),h=$('<td colspan="2">Showing top '+b.length+" OMIMs (by number of regions) out of "+numberWithCommas(a[1])+" </td>"),"enable"==g.page&&10<b.length&&(j=$(' <a href="#" onclick="return false"> (Show all '+b.length+
") </a> "),j.click(function(){i.setOption("page",null);i.setOption("height","500px");i.draw();$(this).remove()}),h.append(j)),j=$(' <a href="relay.php?type=exportOMIMsAndSendBack&regiontype='+currentState.exploreRegionSelected+"&query="+e+'" target="_blank">Export all</a> '),j=!1,e=$("<tr></tr>"),e.append(h),f.append(e),h=autoCompleteCallbackOMIMcategory,showInfoPlot("omimterms")):c[0].startsWith("OMIM:TERMS")&&(k="Search words in OMIM terms",j=new TermCloud(document.getElementById("rangeFeaturePlotTableCloud")),
j.draw(d,null),h=$('<td colspan="2">Showing the '+b.length+" most common words from the "+a[2]+" OMIM terms </td>"),"enable"==g.page&&10<b.length&&(j=$(' <a href="#" onclick="return false"> (Show all '+b.length+") </a> "),j.click(function(){i.setOption("page",null);i.setOption("height","500px");i.draw();$(this).remove()}),h.append(j)),j=$('<a href="relay.php?type=exportOMIMTermsAndSendBack&regiontype='+currentState.exploreRegionSelected+"&query="+e+'" target="_blank"> Export all </a>'),j=!1,e=$("<tr></tr>"),
e.append(h),f.append(e),h=autoCompleteCallbackOMIMterm,showInfoPlot("omimwords"));c[4]&&(e=$('<tr id="rangeFeatureAutocompleteSearch"></tr>'),k=$('<td><label style="float:left;">'+k+'</label><input id="exampleAutocomplete" type="text" size="30" style="float:left;"/></td>'),c[0].startsWith("GENENAME:")&&(c=$('<div class="ui-icon ui-icon-play ui-icon-turnred selectGeneSymbol" style="float:left;"></div>'),k.append(c)),e.append(k),c=$("<td></td>"),j&&c.append(j),e.append(c),f.prepend(e),$("#exampleAutocomplete").autocomplete({source:h,
delay:400,minLength:0}));$("#rangeFeaturePlotMain").show()}function addTermsSlider(a,b,c,f,e,d){var g=$("<div></div>");g.slider({range:!0,min:a,max:b,values:[a,b],slide:function(a,b){(10>b.values[0]||109<b.values[0])&&(10>b.values[1]||109<b.values[1])&&$("#"+d).text("Show only the "+c.sum(b.values[0],b.values[1])+" "+getReadableFeatureText(f+b.values[0]+"--"+f+b.values[1]))}});$("#"+e).append(g)}
function updateOpenedFeatureRegionsList(a){$("#rangeFeaturePlotMain").children().remove();var b=$('<div id="rangeFeaturePlot"></div>');$("#rangeFeaturePlotMain").append(b);showInfoPlot("nodescription");b.append($('<div id="rangeFeaturePlotTable" style="float:left;"></div>'));var c=[],f=0,e=null;$.each(a[4],function(a){a=a.split("_");null==e&&(e=a);c.push(['<a href="'+("http://genome.ucsc.edu/cgi-bin/hgTracks?db="+settings.genome+"&position="+a[a.length-3]+"%3A"+a[a.length-2]+"-"+a[a.length-1])+'" target="_blank">UCSC</a>',
a[a.length-3],parseInt(a[a.length-2],10),parseInt(a[a.length-1],10)]);f+=1});var d=new google.visualization.DataTable;d.addColumn("string","URL");d.addColumn("string","chromosome");d.addColumn("number","start");d.addColumn("number","end");d.addRows(c);var g=new google.visualization.ChartWrapper({chartType:"Table",containerId:"rangeFeaturePlotTable",dataTable:d,options:{page:"enable",sortColumn:1,sortAscending:!1,allowHtml:!0,width:"500px"}});g.draw();var d=getQuery("::qq::","Eregion","main"),i=currentState.exploreRegionSelected,
h=$('<div id="exportLinksDiv"></div>');b.append(h);h.append($("<a href='relay.php?type=exportRegionsAndSendBack&exportType=URL&regiontype="+i+"&query="+d+"' target='_blank'>Export all</a><br/><br/>"));h.append($("<a href='relay.php?type=exportRegionsAndSendBack&exportType=TEXTFILE&regiontype="+i+"&query="+d+"' target='_blank'>Download as text file</a><br/><br/>"));var k;k="http://genome.ucsc.edu/cgi-bin/hgTracks?db="+settings.genome;k=k+"&position="+e[e.length-3]+"%3A"+e[e.length-2]+"-"+e[e.length-
1];k=k+"&hgt.customText="+encodeURIComponent("http://epiexplorer.mpi-inf.mpg.de/relay.php?type=exportRegionsAndSendBack&exportType=UCSC&regiontype="+i+"&query="+d);h.append($("<a href='"+k+"' target='_blank'>Export as custom track in UCSC Genome Browser</a><br/><br/>"));h.append($("<a href='relay.php?type=exportRegionsAndSendBack&exportType=GALAXY&regiontype="+i+"&query="+d+"' target='_blank'>Export to Galaxy</a><br/><br/>"));h.append($("<a href='relay.php?type=exportRegionsAndSendBack&exportType=HYPERBROWSER&regiontype="+
i+"&query="+d+"' target='_blank'>Export to the Genomic HyperBrowser</a><br/><br/>"));200>f?b.append($("<p style='clear:both;'>Listing all "+f+" regions</p>")):b.append($("<p style='clear:both;'>Listing "+f+" regions out of "+a[2]+"</p>"));if(10<f){var j=$(' <a href="#" onclick="return false"> Show full table </a> ');j.click(function(){g.setOption("page",null);g.setOption("height","350px");g.draw();j.remove()});b.append(j)}$("#rangeFeaturePlotMain").show();$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureTable(a,b){var c=b[0].replace(/OVERLAP/g,settings.overlap).replace(/TISSUE/g,settings.tissue);updateOpenedFeatureTableLines(a,c,b,!0);$(".progress_image_feature").remove();$(".progress_image_feature_plot").remove()}
function updateOpenedFeatureTableLines(a,b,c,f){var f=f&&""!=currentState.referenceQuery.genome,e=[],d={},g=[],i=[],h="-"==b.charAt(0),k=parseInt($("#totalDocuments").text().replace(/,/g,""),10),j=4==$("#openedFeatureResults").siblings("input:hidden").length,l=[];f&&(referenceQuery=h?currentState.referenceQuery.query.replace(/BASEREFQUERY/g,b.substr(1)+"*"):currentState.referenceQuery.query.replace(/BASEREFQUERY/g,b+"*"),answerQuery(currentState.referenceQuery.dataset,referenceQuery,1500,0,!1,"",
function(a){$.each(a[3],function(a,b){var c=parseInt(b,10);currentState.referenceQuery.values[a]=c;l.push(a)})}));$.each(a[3],function(a){l.push(a)});l.sort();var m=null;$.each(l,function(c,l){if(m!=l){m=l;var s=0;void 0!==a[3][l]&&(s=a[3][l]);var t=0;f&&void 0!==currentState.referenceQuery.values[l]&&(t=currentState.referenceQuery.values[l]);var o;void 0!=overlapLabels[l]?o="-"==b.charAt(0)?"without "+overlapLabels[l]:overlapLabels[l]:0<b.length&&l.startsWith(b)?(o=l.substr(b.length),o=0<o.length?
o:getReadableFeatureText(l)):o="-"==b.charAt(0)?l.startsWith(b.substr(1))?"without "+l.substr(b.length-1):l:getReadableFeatureText(l);var q,u;h?(q=k-parseInt(s,10),f&&(u=currentState.referenceQuery.totalNumber-parseInt(t,10)),e[o]=[q,u]):(q=numberWithCommas(s),e[o]=[parseInt(s,10),t]);g.push(o);i.push(e[o]);var p=j?$('<tr class="listResults" style="width:100%;"><td align="left" title="Click to select only these regions">'+o+'</td><td align="right" title="Click to select only these regions">'+q+'</td><td class="zoomINAdvanced" title="See the full distribution ..."><span class="ui-icon ui-icon-zoomin ui-icon-turnred" style="float:right;"/></td></tr>'):
$('<tr class="listResults" style="width:100%;"><td class="ui-icon ui-icon-triangle-1-e" style="float:left;padding:0;" title=""></td><td align="left" title="Click to select only these regions">'+o+'</td><td align="right" title="Click to select only these regions">'+q+"</td></tr>");if(h)p.one("click",function(a){a.stopPropagation();addResultsRefinementAndUpdate("","-"+l,-1,!0)}),$("#openedFeatureResults").prepend(p);else{if(4==$("#openedFeatureResults").siblings("input:hidden").length){var v=function(){var a=
$("#openedFeatureResults").siblings("input:hidden");if(4==a.length){var b=a[3].value,c=a[2].value;$.each(l.split(":"),function(a,b){c=c.replace("POS"+a+"SOP",b)});$(".featureRangeOrRatioResults").remove();$('<tr><td COLSPAN="3"><div class="featureRangeOrRatioResults"></div></td></tr>').insertAfter(p);updateOpenedFeatureCore(b,currentState.exploreRegionSelected,getQuery(" ",c+"*","main"),100,0,"",[c,2,0])}};p.children(".zoomINAdvanced").click(function(a){a.stopPropagation();v()});d[o]=v}p.one("click",
function(a){a.stopPropagation();addResultsRefinementAndUpdate("",l,q,!0)});$("#openedFeatureResults").append(p)}}});0<g.length?updateOpenedFeatureTablePlotGoogle(e,g,i,d,c,f):($("#rangeFeaturePlotMain").children().remove(),$("#rangeFeaturePlotMain").show(),$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr style="width:100%;"><td align="left">No regions fit this query</td><td></td></tr></table>')))}
function updateOpenedFeatureTablePlotGoogle(a,b,c,f,e,d){$("#rangeFeaturePlotMain").children().remove();$("#rangeFeaturePlotMain").show();showInfoPlot("overlaptable");$("#rangeFeaturePlotMain").append($('<table id="rangeFeaturePlotTable"><tr><td colspan="2"><div id="rangeFeaturePlot"></div></td></tr></table>'));-1<e[0].search("OVERLAP")&&($("#rangeFeaturePlotTable").append('<tr><td>Select overlap criterion:</td><td><select id="overlapSelect"><option value="Eoverlaps">Any overlap (at least 1bp)</option><option value="Eoverlaps10p">Medium overlap (at least 10%)</option><option value="Eoverlaps50p">Strong overlap (at least 50%)</option></select></td></tr>'),
$("#overlapSelect").val(settings.overlap));-1<e[0].search("TISSUE")&&($("#rangeFeaturePlotTable").append('<tr><td>Select tissue:</td><td><select id="tissueSelect"></select></td></tr>'),$.each(settings.defaultTissues,function(a,b){$("#tissueSelect").append($('<option value="'+b+'">'+getTissueDescription(b)+"</option>"))}),$("#tissueSelect").val(settings.tissue));e=800;4>b.length&&(e=250*b.length);var g,a={width:e,height:400,colors:["#FA9627","#999999"],legend:"top",hAxis:{maxAlternation:3,textStyle:{fontName:"Tahoma",
fontSize:10},showTextEvery:1},vAxis:{title:"Percent of overlapping regions",titleTextStyle:{italic:!1},format:"#,###.##%",minValue:0,maxValue:1},chartArea:{left:60,width:e-60}};d?(g={cols:[{label:"Overlap",type:"string"},{label:"Current selection ("+numberWithCommas(currentState.totalNumberOfRegions)+")",type:"number"},{label:"Reference ("+numberWithCommas(currentState.referenceQuery.totalNumber)+")",type:"number"}],rows:[]},$.each(b,function(a,b){g.rows.push({c:[{v:b,f:b},{v:c[a][0]/currentState.totalNumberOfRegions,
f:c[a][0]+""},{v:c[a][1]/currentState.referenceQuery.totalNumber,f:c[a][1]+""}]})})):(g={cols:[{label:"Overlap",type:"string"},{label:"Current selection ("+numberWithCommas(currentState.totalNumberOfRegions)+")",type:"number"}],rows:[]},$.each(b,function(a,b){g.rows.push({c:[{v:b,f:b},{v:c[a][0]/currentState.totalNumberOfRegions,f:c[a][0]+""}]})}),a.legend="none");var i=new google.visualization.DataTable(g,0.6),d="";1<b.length?(chartType="ColumnChart",d="table",a.width=e,a.chartArea.width=e-60,a.height=
400):(chartType="Table",d="chart",a.width=null,a.chartArea.width=null,a.height=null);var h=new google.visualization.ChartWrapper({chartType:chartType,containerId:"rangeFeaturePlot",dataTable:i,options:a});h.draw();google.visualization.events.addListener(h,"select",function(){for(var a=h.getChart().getSelection(),b=0;b<a.length;b++){var c=a[b];if(null!=c.row&&null!=c.column){if(void 0!==f[i.getValue(c.row,0)])f[i.getValue(c.row,0)]()}else if(null!=c.row&&void 0!==f[i.getValue(c.row,0)])f[i.getValue(c.row,
0)]()}});b=$('<tr class="showTableLink"><td colspan="2"><a href="#" onclick="return false">Show as '+d+"</a></td></tr>");b.click(function(){"Table"==h.getChartType()?(h.setChartType("ColumnChart"),h.setOption("height",400),$(".showTableLink a").text("Show as table"),$("tr.toPNGRow").show()):(h.setChartType("Table"),h.setOption("height",null),$(".showTableLink a").text("Show as chart"),$("tr.toPNGRow").hide());h.draw()});$(".showTableLink").remove();$("#rangeFeaturePlotTable").append(b);$("tr.toPNGRow").remove();
b=$('<tr class="toPNGRow"><td class="toPNGButton"><a href="#" onclick="return false">To PNG</a><input type="hidden" value="'+a.width+'"/> <input type="hidden" value="'+a.height+'"/><input type="hidden" value="'+h.getContainerId()+'"/></td></tr>');$("#rangeFeaturePlotTable").append(b)}function referenceSelect(a,b,c,f,e){currentState.referenceQuery.genome=a;currentState.referenceQuery.dataset=b;currentState.referenceQuery.editable=!1;currentState.referenceQuery.queryParts=c;referenceUpdate(f,e)}
function referenceUpdate(a,b){var c=currentState.referenceQuery.queryParts.slice(0);c.push("Eregion");currentState.referenceQuery.query=getQueryFromParts(" ","BASEREFQUERY",c);currentState.referenceQuery.values={};answerQuery(currentState.referenceQuery.dataset,currentState.referenceQuery.query.replace(/BASEREFQUERY/g,"Eregion"),0,0,b,"",function(b){currentState.referenceQuery.totalNumber=b[2];if(0>=currentState.referenceQuery.totalNumber)alert("The reference query must have some results"),currentState.referenceQuery=
getDefaultReferenceState();else{$("#referenceListing").show();$("#referenceListing").html("");var c=$("<p class='referencelistingParagraph' style='padding-left:"+settings.standardIdentation+"px;'></p>");c.append($("<div><i>Genome</i>: "+currentState.referenceQuery.genome+"</div>"));c.append($("<div><i>Regions</i>: "+currentState.datasetInfo[currentState.referenceQuery.dataset].officialName+" ("+numberWithCommas(currentState.referenceQuery.totalNumber)+")</div>"));$.each(currentState.referenceQuery.queryParts,
function(a,b){c.append($("<div><span class='referencePrefixRaw'>"+b+"</span><i>"+getReadableFeatureText(b)+"</i><span class='ui-icon ui-icon-closethick ui-icon-turnred referencelistingRefinementX' ></span></div>"))});$("#referenceListing").append(c);var b=$('<div class="activeSearchBox" style="margin-top:10px;"><b style="padding-left:'+settings.standardIdentation+'px;">Reference regions</b></div>'),d=$('<span title="Remove the reference" class="ui-icon ui-icon-closethick ui-icon-turnred" style="margin-right:5px;float:right;"></span>');
d.click(function(){$("#referenceListing").hide();$("#referenceListing").removeClass("pretty-hover");$("#referenceListing").html("");$("#currentLinkLocation").text("");currentState.referenceQuery=getDefaultReferenceState();currentState.exploreRegionSelected!=settings.defaultRegionSelected&&updateCurrentSelectionOverlapPlot(!1)});b.append(d);var g=$('<span title="Show the reference text" class="ui-icon ui-icon-newwin ui-icon-turnred" style="margin-right:5px;float:left;"></span>'),i=$('<span title="Hide the reference text" class="ui-icon ui-icon-arrowthickstop-1-s ui-icon-turnred" style="margin-right:5px;float:left;"></span>');
g.click(function(){$(".referencelistingParagraph").show();g.hide();i.show()});b.prepend(g);g.hide();i.click(function(){$(".referencelistingParagraph").hide();g.show();i.hide()});b.prepend(i);var h=$('<span title="This reference is currently dynamic. Press here, if you want to keep it constant" class="ui-icon ui-icon-unlocked ui-icon-turnred" style="margin-right:5px;float:right;"></span>'),k=$('<span title="This reference is currently constant. Press here, if you want to make it dynamic" class="ui-icon ui-icon-locked ui-icon-turnred" style="margin-right:5px;float:right;"></span>');
h.click(function(){currentState.referenceQuery.editable=!1;$(".referencelistingRefinementX").hide();h.hide();k.show()});b.append(h);k.click(function(){currentState.referenceQuery.editable=!0;$(".referencelistingRefinementX").show();h.show();k.hide();g.click()});b.append(k);!1==currentState.referenceQuery.editable?(h.hide(),$(".referencelistingRefinementX").hide()):(k.hide(),$(".referencelistingRefinementX").show());$("#referenceListing").prepend(b);$("#referenceListing").prepend("");d.mouseleave();
a&&updateCurrentSelectionOverlapPlot(!0);$("#currentLinkLocation").text("")}})}
function addRegionSelectionToTheQueryListing(a,b,c){b=$('<table class="regionsListingTable" cellspacing="0"></table>');a=$('<tr class="queryRegions" title="'+a+'"><td><b><label id="totalDocuments" style="margin-right:5px;float:left;">'+numberWithCommas(currentState.totalNumberOfRegions)+'</label><span style="float:left;" class="queryRegionsRaw">'+a+"</span></b></td></tr>");a.append($("<td/>"));if(settings.allowRemoveRegionSelection){var f=$('<td title="Remove this selection and explore other regions"><span class="ui-icon ui-icon-closethick ui-icon-turnred"></span></td>');
f.one("click",activateMode_ExploreRegionSelection);a.append(f)}b.append(a);$(".regionsSelected").append(b);c&&highlightElement(a,1E3,2)}
function addRefinementToTheQueryListing(a,b){var c=a;0==a.length&&(c=getReadableFeatureText(b));"Unknown"==c&&(c=b);currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");if(0<$(".queryRefinementORButtonActive").length){var f=$(".queryRefinementORButtonActive");deactivateORClause(f,!1);var e=f.parent().siblings("td.queryPrefixMainTD").children("span.queryPrefixRaw"),d=e.text()+"|"+b;e.text(d);
f=f.parent().siblings("td.queryPrefixMainTD").children("span.queryPrefixTitle");c=f.html()+" <b>OR</b> "+c;f.html(c);updateResultsAndDocuments(!1,!0)}else{var g=$('<tr class="queryPrexix" title="'+a+'"><td class="queryPrefixMainTD"><span class="queryPrefixRaw">'+b+'</span><span class="queryPrefixTitle">'+c+"</td></tr>"),c=$('<td title="Remove this refinement" ><span class="ui-icon ui-icon-closethick ui-icon-turnred"/></td>');c.one("click",function(){$("#rangeFeaturePlotMain").children().remove();
g.remove();currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");closeOpenFeatureBox();updateCurrentSelectionOverlapPlot(!1);updateResultsAndDocuments(!1,!0)});f=$('<td title="Add additional conditions for this refinement"><span class="ui-icon ui-icon-arrowthick-2-e-w ui-icon-turnred queryRefinementORButtonDeactive"/></td>');g.append(f);g.append(c);$("table.regionsListingTable").append(g);""!=
currentState.referenceQuery.genome&&currentState.referenceQuery.editable&&(currentState.referenceQuery.queryParts.push(b),referenceUpdate(!1,!1))}}
function activateORClause(a,b){$(".queryRefinementORButtonActive").each(function(){deactivateORClause($(this),!1)});a.removeClass("ui-icon-arrowthick-2-e-w");a.removeClass("queryRefinementORButtonDeactive");a.addClass("ui-icon-cancel");a.addClass("queryRefinementORButtonActive");a.attr("title","Cancel the OR selection");var c=a.parent().siblings("td.queryPrefixMainTD").children("span.queryPrefixRaw");c.addClass("queryPrefixRawOR");c.removeClass("queryPrefixRaw");currentState.currentOverlaps=settings.defaultCurrentOverlaps;
currentState.currentNeighborhood=settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");b&&(0<$(".featureBoxOpened").length?updateOpenFeature(!1,!0,!0):(updateCurrentSelectionOverlapPlot(!1),updateOpenFeature(!1,!1,!0)))}
function deactivateORClause(a,b){a.removeClass("ui-icon-cancel");a.removeClass("queryRefinementORButtonActive");a.addClass("ui-icon-arrowthick-2-e-w");a.addClass("queryRefinementORButtonDeactive");a.attr("title","Add additional conditions for this refinement");var c=a.parent().siblings("td.queryPrefixMainTD").children("span.queryPrefixRawOR");c.addClass("queryPrefixRaw");c.removeClass("queryPrefixRawOR");currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=
settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");b&&(0<$(".featureBoxOpened").length?updateOpenFeature(!1,!0,!0):(updateCurrentSelectionOverlapPlot(!1),updateOpenFeature(!1,!1,!0)))}
function addResultsRefinementAndUpdate(a,b,c,f){(0==c||"0"==c)&&alert("This refinement will lead to 0 remaining results!");$("#rangeFeaturePlotMain").children().remove();addRefinementToTheQueryListing(a,b,!0);f&&(closeOpenFeatureBox(),updateCurrentSelectionOverlapPlot(!1));-1!=c?(currentState.totalNumberOfRegions=parseInt(c.replace(/,/g,"")),$("#totalDocuments").text(numberWithCommas(currentState.totalNumberOfRegions))):updateResultsAndDocuments(!1,!0)}
function updateNumberOfDocuments(a){currentState.totalNumberOfRegions=parseInt(a[2]);$("#totalDocuments").text(numberWithCommas(currentState.totalNumberOfRegions))}function answerQuery(a,b,c,f,e,d,g){""!=a&&$.ajax({async:e,type:"GET",url:"relay.php",dataType:"json",data:"type=basequeryJSON&regiontype="+a+"&query="+b+"&ncompl="+c+"&nhits="+f+"&extraSettings="+d,success:function(a){g(a)}})}
function showInfoPlot(a){a=getTextForPlotDescription(a);""!=a?($(".infoboxMain").show(),$(".infoboxPlot").show(),hideIframe(),$(".infoboxPlot").html(""),$(".infoboxPlot").append('<p class="infoboxTitle"><b>Chart description:</b> '+a+"</p>")):$(".infoboxPlot").html("")}function showInfoFeature(a,b){""!=b&&($(".infoboxMain").show(),$(".infoboxFeature").html(""),$(".infoboxFeature").append('<p class="infoboxTitle"><b>Annotation description: </b> '+b+"</p>"))}
function loadDatasetInfo(a,b){void 0==currentState.datasetInfo[a]&&$.ajax({type:"GET",url:"relay.php",dataType:"json",async:b,data:"type=getDatasetInfo&datasetName="+a,success:function(b){currentState.datasetInfo[a]=b}})}
function showInfoRegionSet(a,b){currentState.exploreRegionSelected=a;loadDatasetInfo(a,!1);var c=$('<p class="infoboxTitle"></p>'),f=$("<h3></h3>");f.text(currentState.datasetInfo[a].officialName+" ("+numberWithCommas(currentState.datasetInfo[a].numberOfRegions)+" regions)");c.append(f);f=!1==currentState.datasetInfo[a].isDefault?$('<p class="infoboxDescription">'+currentState.datasetInfo[a].description+'</p><p class="tutorialMode">You may share this dataset using its unique ID ('+a+")</p>"):$('<p class="infoboxDescription">'+
currentState.datasetInfo[a].description+"</p>");c.append(f);currentState.datasetInfo[a].moreInfoLink&&(f=$('<a href="'+currentState.datasetInfo[a].moreInfoLink+'" target="_blank">Click here for more info</a>'),c.append(f));$(".infoboxMain").show();hideIframe();$(".infoboxRegions").html("");$(".infoboxRegions").show();$(".infoboxRegions").append(c);b&&(c=$('<p class="infoboxDescription regionSelectionLinkFromInfoBox"><img src="extras/media-playback-start.png" width="16px" height="16px"/><a href="#" onclick="return false;">Explore this region set</a></p>'),
c.click(function(){$(this).remove();currentState.exploreRegionSelected=a;currentState.totalNumberOfRegions=currentState.datasetInfo[currentState.exploreRegionSelected].numberOfRegions;activateMode_ExploreRegionChosen(!1)}),$(".infoboxRegions").append(c))}
function featureOpenBox(){hideIframe();var a=$(this).children("h4")[0];closeOpenFeatureBox();$(this).unbind("click");$(this).addClass("featureBoxOpened");$(a).children(".ui-icon-search").addClass("ui-icon-circle-check");$(a).children(".ui-icon-search").removeClass("ui-icon-search");$(a).append($('<img name="progress_image_feature" src="extras/ajax-loader.gif" class="progress_image_feature" align="right"></img>'));$(".visualization").append($('<img name="progress_image_feature_plot" src="extras/ajax-loader-big.gif" class="progress_image_feature_plot" align="center"></img>'));
$(this).append($('<table id="openedFeatureResults" style="padding-left:'+(parseInt($(a).css("padding-left").slice(0,-2),10)+settings.standardIdentation)+'px;" cellspacing="0"></table>'));updateOpenFeature(!1,!0,!1)}
function closeOpenFeatureBox(){hideIframe();currentState.featureCurrentVisualization=settings.genome+"summary";$(".ui-icon-circle-check").not("#iconLegend .ui-icon-circle-check").addClass("ui-icon-search");$(".ui-icon-circle-check").not("#iconLegend .ui-icon-circle-check").removeClass("ui-icon-circle-check");$("#rangeFeaturePlotMain").hide();$("#openedFeatureResults tr").remove();$("#openedFeatureResults div.featureRangeOrRatioResults").remove();$("#openedFeatureResults").remove();$(".featureBoxOpened").one("click",
featureOpenBox);$(".featureBoxOpened").removeClass("featureBoxOpened")}
function featureOpenBranch(a,b){var c=$(a),f=c.parent();c.children(".ui-icon").removeClass("ui-icon-plusthick");c.children(".ui-icon").addClass("ui-icon-minusthick");c.children(".ui-icon").addClass("ui-icon-turnred");var e=!1;if(b&&0<c.siblings("input.featureBranchOverlapPrefixes").length)currentState.overlapSelection=c.siblings("input.featureBranchOverlapPrefixes").val().split(","),e=!0;if(b&&0<c.children("input.featureBranchName").length){var d=c.children("input.featureBranchName").val();if(e&&
void 0!==currentState.featuresElements[d])currentState.featureCurrentVisualization=d,$("#currentLinkLocation").text("")}!0==e&&updateCurrentSelectionOverlapPlot(!1);f.addClass("featureBranchOpened");f.children().show();c.children(".ui-icon").one("click",featureCloseBranch)}
function featureCloseBranch(a){a.stopPropagation();a=$(this).parent().parent();a.removeClass("featureBranchOpened");a.children("div").hide();$(this).removeClass("ui-icon-minusthick");$(this).removeClass("ui-icon-turnred");$(this).addClass("ui-icon-plusthick");$(this).unbind("click")}
function activateMode_ExploreRegionChosen(a){initFeatures(!0);currentState.isRegionSelected=!0;$(".features").show();$("tr.reloadUserDatasetTD").hide();$(".activateUserDatasetSpan").text("");$(".regionsSelection").hide();addRegionSelectionToTheQueryListing(currentState.datasetInfo[currentState.exploreRegionSelected].officialName,currentState.exploreRegionSelected,a);$(".regionsSelected").show();$(".visualization").show();$(".menuSeparator").show();$("#rangeFeaturePlotMain").show();$(".infoboxMain").show();
hideIframe();$("#exportMenu").show();a&&updateCurrentSelectionOverlapPlot(!1)}
function visualizeMode_ExploreRegionSelection(){$(".queryRegions").remove();$(".queryPrexix").remove();$("table.regionsListingTable").remove();$(".features").hide();$(".regionsSelection").show();$(".regionsSelected").hide();$("#currentLinkLocation").text("");$("#rangeFeaturePlotMain").show();$(".visualization").show();$(".menuSeparator").hide();$(".infoboxDetail").html("");$(".infoboxMain").hide();$("#exportMenu").hide();closeOpenFeatureBox()}
function activateMode_ExploreRegionSelection(){currentState.isRegionSelected=!1;currentState.exploreRegionSelected=settings.defaultRegionSelected;currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");currentState.overlapSelection=settings.overlapSelection[settings.genome];currentState.featureCurrentVisualization=settings.genome+"summary";visualizeMode_ExploreRegionSelection()}
function initRegionSets(){$("#regionsTable").html("");$.ajax({type:"GET",url:"relay.php",dataType:"json",data:"type=regiontypes&sourceType="+settings.sourceType+"&genome="+settings.genome,success:function(a){currentState.datasetInfo=a;var b=[];$.each(currentState.datasetInfo,function(a,c){b.push(c.officialName)});b.sort();b.reverse();$.each(currentState.datasetInfo,function(a,c){var f=jQuery.inArray(c.officialName,b);b[f]=a});var c=$("#regionsTable"),f=0;$.each(b,function(a,b){var a=b,b=currentState.datasetInfo[a],
g=$('<tr class="regionsButton regionsButtonHover" title="See more information"></tr>');g.append($('<input type="hidden" value="'+a+'"/>'));g.append($('<td align="left" class="regionsetInfoButton hoverChangeIcon" title="Show information about this region set"><img src="extras/dialog-information.png" class="selectDatasetIcon"></img><div class="selectDatasetText">Info</div></td>'));g.append($('<td class="regionsetSelectButton" align="left" title="Explore this dataset">'+b.officialName+"</td>"));g.append($('<td class="regionsetSelectButton" align="right" title="Explore this dataset">'+
numberWithCommas(b.numberOfRegions)+"</td>"));g.append($('<td align="center" class="regionsetSelectButton hoverChangeIcon" title="Explore this dataset"><img src="extras/media-playback-start.png" class="selectDatasetIcon"></img><div class="selectDatasetText">Select</div></td>'));c.prepend(g);f+=parseInt(b.numberOfRegions,10)});$.each(currentState.userDatasets,function(a,b){activateUserDatasetFunction(b,currentState.loadedUserDatasetFromLink==b,!1,!0)});currentState.totalNumberOfRegions=f}})}
function genomeChanged(){$("#genomeSelectLabel div.menuicontext").text("Genome ("+settings.genome+")");$.cookie("cgs:settings:genome",settings.genome,{expires:14});currentState.overlapSelection=settings.overlapSelection[settings.genome];currentState.featureCurrentVisualization=settings.genome+"summary";if($.cookie("cgs:settings:userdatasets:"+settings.genome)){var a=$.cookie("cgs:settings:userdatasets:"+settings.genome).split(";");currentState.userDatasets=0<a[0].length?a:[]}else currentState.userDatasets=
[],$.cookie("cgs:settings:userdatasets:"+settings.genome,currentState.userDatasets.join(";"),{expires:30});initRegionSets();activateMode_ExploreRegionSelection()}
function initSettings(){$("#genomeSelectLabel div.menuicontext").text("Genome ("+settings.genome+")");$("body").delegate(".genomeSelect","click",function(){settings.genome=$(this).text();genomeChanged()});$("body").delegate("#overlapSelect","change",function(){settings.overlap=$("#overlapSelect option:selected").val();$.cookie("cgs:settings:overlap",settings.overlap,{expires:14});currentState.exploreRegionSelected!=settings.defaultRegionSelected&&(0==$(".featureBoxOpened").size()?updateCurrentSelectionOverlapPlot(!0):
updateOpenFeature(!1,!0,!1))});$("body").delegate("#tissueSelect","change",function(){settings.tissue=$("#tissueSelect option:selected").val();$.cookie("cgs:settings:tissue",settings.tissue,{expires:14});0==$(".featureBoxOpened").size()?updateCurrentSelectionOverlapPlot(!1):updateOpenFeature(!1,!0,!1)})}function showExternalPageInIFrame(a){$("div.content").hide();$("#contentFrameID").attr("src",a);$("div.contentFrame").show()}
function hideIframe(){$("#contentFrameID").attr("src","");$("div.contentFrame").hide();$("div.content").show()}
function initStartingSettings(){var a=getParameterByName("analysisLink");activateMode_ExploreRegionSelection();""==currentState.loadedUserDatasetFromLink&&showExternalPageInIFrame("welcome.php");null!=a&&$.ajax({type:"GET",url:"relay.php",async:!1,data:{type:"getLinkData",analysisLink:a},dataType:"json",success:function(a){if(a[0]!=settings.genome)settings.genome=a[0],genomeChanged();if(""!=a[1])currentState.exploreRegionSelected=a[1],void 0==currentState.datasetInfo[currentState.exploreRegionSelected]&&
loadDatasetInfo(currentState.exploreRegionSelected,!1),!1==currentState.datasetInfo[currentState.exploreRegionSelected].isDefault&&(-1==jQuery.inArray(a[1],currentState.userDatasets)?(currentState.datasetInfo[currentState.exploreRegionSelected]=void 0,activateUserDatasetFunction(a[1],!1,!1,!0)):activateUserDatasetFunction(a[1],!1,!1,!1)),showInfoRegionSet(currentState.exploreRegionSelected,!1),currentState.totalNumberOfRegions=currentState.datasetInfo[currentState.exploreRegionSelected].numberOfRegions,
activateMode_ExploreRegionChosen(!1),""!=a[2]&&$.each(a[2].split("::qq::"),function(a,b){addRefinementToTheQueryListing("",b,!1)}),updateResultsAndDocuments(!1,!0);if(""!=a[4]&&""!=a[5]){void 0==currentState.datasetInfo[a[5]]&&loadDatasetInfo(a[5],!1);!1==currentState.datasetInfo[a[5]].isDefault&&(-1==jQuery.inArray(a[5],currentState.userDatasets)?activateUserDatasetFunction(a[5],!1,!1,!0):activateUserDatasetFunction(a[5],!1,!1,!1));var c=[];$.each(a[6].split("::qq::"),function(a,b){b.startsWith("BASEREFQ")||
b.startsWith("Eregion")||c.push(b)});referenceSelect(a[4],a[5],c,!1,!1)}""!=a[3]&&void 0!==currentState.featuresElements[a[3]]?loadVisualizationByID(a[3]):updateCurrentSelectionOverlapPlot(!0)}})}
function initExploreButtons(){$("body").delegate(".exploreDefaultDatasetsButton","click",activateMode_ExploreRegionSelection);$("div.regions").delegate("td.showReloadUserDatasetButton","click",function(){$("tr.reloadUserDatasetTD").is(":visible")?$("tr.reloadUserDatasetTD").hide():$("tr.reloadUserDatasetTD").show()});$("td.uploadNewDatasetButton").click(function(){showExternalPageInIFrame("upload.php")});$("body").delegate(".exportRegionsButton","click",function(){var a=getQuery("::qq::","Eregion",
"main");window.open("relay.php?type=exportRegionsAndSendBack&regiontype="+currentState.exploreRegionSelected+"&query="+a,"CGSExport","").focus()});$("body").delegate(".useAsReferenceButton","click",function(){$("#currentLinkLocation").text("");var a=[];$.each($("span.queryPrefixRaw"),function(b,c){a.push($(c).text())});referenceSelect(settings.genome,currentState.exploreRegionSelected,a,!0,!0)});$("body").delegate("td.toPNGButton","click",function(){var a=800,b=400,c=$(this).children("input:hidden");
if(3==c.length){if(a=c[0].value,b=c[1].value,containerID=c[2].value,(c=$("#"+containerID+" iframe").contents().find("body").html())&&0<c.length){var f=c.indexOf("<svg"),e=c.indexOf("</svg>"),c=c.substring(f,e+6),a=$('<canvas class="canvasChartElement" id="canvasPlot'+containerID+'" width="'+a+'px" height="'+b+'px"></canvas>');$("#"+containerID).append(a);canvg("canvasPlot"+containerID,c);c=document.getElementById("canvasPlot"+containerID).toDataURL("image/png");c=c.substr(c.indexOf(",")+1).toString();
b=document.createElement("input");b.setAttribute("name","imgdata");b.setAttribute("value",c);c=document.createElement("form");c.method="post";c.action="saveAsPNG.php";c.appendChild(b);document.body.appendChild(c);c.submit();document.body.removeChild(c);a.remove()}}else alert("Error: wrong number of inputs")});$("body").delegate(".activateUserDataset","click",function(){var a=$("#userDatasetID").val().trim();-1==jQuery.inArray(a,currentState.userDatasets)?activateUserDatasetFunction(a,!0,!1,!0):($(".activateUserDatasetSpan").show(),
$(".activateUserDatasetSpan").text("The dataset is already active").fadeOut(2E3,function(){}));$("#userDatasetID").val("Paste here a dataset ID and press enter")});$("#toggleCheckBoxes").button().click(function(){$("#exportQueryDataForm").toggleCheckboxes(":not(#regionsCheckBox)")});$("#checkCheckBoxes").button().click(function(){$("#exportQueryDataForm").checkCheckboxes(":not(#regionsCheckBox)")});$("#uncheckCheckBoxes").button().click(function(){$("#exportQueryDataForm").unCheckCheckboxes(":not(#regionsCheckBox)")});
$("div.regions").delegate(".queryRefinementORButtonDeactive","click",function(){activateORClause($(this),!0)});$("div.regions").delegate(".queryRefinementORButtonActive","click",function(){deactivateORClause($(this),!0)});$("body").delegate(".showNext10Results","click",function(){});$("body").delegate(".selectGeneSymbol","click",function(){var a=$("#exampleAutocomplete").val().toUpperCase();/^[0-9A-Za-z]+$/.test(a)?addResultsRefinementAndUpdate("Overlapping with genes described by the symbol '"+a+
"*'","[Egn:*%23gS:"+a+"*%20Egn:*]",-1,!0):alert("This field must not be empty and must contain only letters and numbers")});$("body").delegate(".referencelistingRefinementX","click",function(){if(currentState.referenceQuery.editable){currentState.referenceQuery.editable=!1;$(this).parent().remove();var a=[];$("span.referencePrefixRaw").each(function(){a.push($(this).text())});currentState.referenceQuery.queryParts=a;referenceUpdate(!0,!1)}});$("div.leftside").delegate("span.referencelistingRefinementX",
"mouseenter",function(){$(this).parent().addClass("pretty-hover")});$("div.leftside").delegate("span.referencelistingRefinementX","mouseleave",function(){$(this).parent().removeClass("pretty-hover")});$("#referenceListing").delegate("div.activeSearchBox span.ui-icon-closethick","mouseenter",function(){$(this).parent().parent().addClass("pretty-hover")});$("#referenceListing").delegate("div.activeSearchBox span.ui-icon-closethick","mouseleave",function(){$(this).parent().parent().removeClass("pretty-hover")});
$("div.leftside").delegate("tr.queryRegions td span.ui-icon-closethick","mouseenter",function(){$(this).parent().parent().parent().addClass("pretty-hover")});$("div.leftside").delegate("tr.queryRegions td span.ui-icon-closethick","mouseleave",function(){$(this).parent().parent().parent().removeClass("pretty-hover")});$("div.leftside").delegate("tr.queryPrexix td span.ui-icon-closethick","mouseenter",function(){$(this).parent().parent().addClass("pretty-hover")});$("div.leftside").delegate("tr.queryPrexix td span.ui-icon-closethick",
"mouseleave",function(){$(this).parent().parent().removeClass("pretty-hover")});$("body").delegate(".selectGeneName","click",function(){var a=$(this).parent().parent().children("td"),b=$(a[1]).text(),c="Overlapping with gene "+b;0<$(a[2]).text().length&&(c=c+" ("+$(a[2]).text()+")");addResultsRefinementAndUpdate(c,"Egn:"+b,-1,!0)});$("body").delegate(".selectGOName","click",function(){var a=$(this).parent().parent().children("td"),b=$(a[1]).text(),c="Overlapping with genes annotated with "+b;0<$(a[4]).text().length&&
(c=c+" ("+$(a[4]).text()+")");addResultsRefinementAndUpdate(c,"gGO:"+b,-1,!0)});$("body").delegate(".selectGOterm","click",function(){var a="[gGO:*%23"+$(this).find("input:hidden").val()+"%20gGO:*]",b=$(this).parent().parent().children("td"),b="Overlapping with genes annotated with GO described by '"+$(b[1]).text()+"'";addResultsRefinementAndUpdate(b,a,-1,!0)});$("body").delegate(".selectOMIMName","click",function(){var a=$(this).parent().parent().children("td"),b=$(a[1]).text().split(":")[1],c="Overlapping with genes annotated with "+
b;0<$(a[4]).text().length&&(c=c+" ("+$(a[4]).text()+")");addResultsRefinementAndUpdate(c,"omimID:"+b,-1,!0)});$("body").delegate(".selectOMIMterm","click",function(){var a="[omimID:*%23"+$(this).find("input:hidden").val()+"%20omimID:*]",b=$(this).parent().parent().children("td"),b="Overlapping with genes annotated with OMIM described by '"+$(b[1]).text()+"'";addResultsRefinementAndUpdate(b,a,-1,!0)});$("body").delegate(".getLinkButton","click",function(){if(currentState.exploreRegionSelected==settings.defaultRegionSelected)$("#currentLinkLocation").text("No dataset selected"),
highlightElement($("#currentLinkLocation"),700,2);else{var a=getQuery("::qq::","","main");a.startsWith("Eregion::qq::")&&(a=a.substr(13));a={type:"getLink",genome:currentState.genome,currentSelection:currentState.exploreRegionSelected,currentQuery:a,currentView:currentState.featureCurrentVisualization,rGenome:"",rSelection:"",rQuery:"",rNORegions:""};if(""!=currentState.referenceQuery.genome)a.rGenome=currentState.referenceQuery.genome,a.rSelection=currentState.referenceQuery.dataset,a.rQuery=currentState.referenceQuery.query.replace(/ /g,
"::qq::"),a.rNORegions=currentState.referenceQuery.totalNumber;$.ajax({type:"GET",url:"relay.php",data:a,dataType:"json",success:function(a){"0"==a[0]?(a="http://epiexplorer.mpi-inf.mpg.de/index.php?analysisLink="+a[1],$("#currentLinkLocation").html('<a href="'+a+'" target="_blank">'+a+"</a>")):$("#currentLinkLocation").text(a[1])}})}});$("#userDatasetID").keypress(function(a){13==a.which&&$(".activateUserDataset").click()});$("#userDatasetID").attr("value","Paste here a dataset ID and press enter");
$("#userDatasetID").focus(function(){$(this).addClass("active");"Paste here a dataset ID and press enter"==$(this).attr("value")&&$(this).attr("value","")});$("#userDatasetID").blur(function(){$(this).removeClass("active");""==$(this).attr("value")&&$(this).attr("value","Paste here a dataset ID and press enter")});$("#showWelcomePageInFrame").click(function(){showExternalPageInIFrame("welcome.php")});$("#showAboutPageInFrame").click(function(){showExternalPageInIFrame("about_epiexplorer.php")});$("#showUploadPageInFrame").click(function(){showExternalPageInIFrame("uploadManagement.php")});
$("#presentationModeSwitch").click(function(){$("div.leftside").is(":visible")?($("div.container span.ui-layout-resizer div.ui-layout-toggler").click(),$(this).html('<img src="extras/measure.png" class="menusubicon">Presentation mode Off')):($("div.container span.ui-layout-resizer div.ui-layout-toggler").click(),$(this).html('<img src="extras/measure.png" class="menusubicon">Presentation mode On'))})}
function initEventDelegationRegionsTable(){$(".regions").delegate(".regionsButtonHover","mouseenter",function(){$(this).addClass("pretty-hover")});$(".regions").delegate(".regionsButtonHover","mouseleave",function(){$(this).removeClass("pretty-hover")});$("div.visualization").delegate("td div.ui-icon-play","mouseenter",function(){$(this).parent().parent().removeClass("google-visualization-table-tr-over");$(this).parent().parent().addClass("pretty-hover")});$("div.visualization").delegate("td div.ui-icon-play",
"mouseleave",function(){$(this).parent().parent().removeClass("pretty-hover")});$(".regions").delegate(".regionsetInfoButton","click",function(){var a=$(this).siblings("input:hidden")[0].value;currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");showInfoRegionSet(a,currentState.exploreRegionSelected!=a);currentState.exploreRegionSelected=a;updateCurrentSelectionOverlapPlot(!1)});$(".regions").delegate(".regionsetSelectButton",
"mouseenter",function(){$(this).parent().children("td.regionsetSelectButton").css("background-color","#F7E7D7")});$(".regions").delegate(".regionsetSelectButton","mouseleave",function(){$(this).parent().children("td.regionsetSelectButton").css("background-color",null)});$(".regions").delegate(".regionsetSelectButton","click",function(){var a=$(this).siblings("input:hidden")[0].value;currentState.exploreRegionSelected=a;currentState.currentOverlaps=settings.defaultCurrentOverlaps;currentState.currentNeighborhood=
settings.defaultCurrentOverlaps;$("#currentLinkLocation").text("");currentState.totalNumberOfRegions=currentState.datasetInfo[currentState.exploreRegionSelected].numberOfRegions;activateMode_ExploreRegionChosen(!1);showInfoRegionSet(a,currentState.exploreRegionSelected!=a);updateCurrentSelectionOverlapPlot(!1);$(".regionSelectionLinkFromInfoBox").remove()});$("body").delegate(".hoverChangeIcon","mouseenter",function(){var a=$(this).children("img")[0];$(a).attr("src",$(a).attr("src").split(".").join("-hover."))});
$("body").delegate(".hoverChangeIcon","mouseleave",function(){var a=$(this).children("img")[0];$(a).attr("src",$(a).attr("src").split("-hover.").join("."))})}function initEventDelegationFeatureListing(){$(".features").delegate(".featureHover","hover",function(){$(this).toggleClass("pretty-hover")});$("body").delegate("#openedFeatureResults tr.listResults","hover",function(){$(this).toggleClass("pretty-hover");$(this).toggleClass("ui-corner-all")})}
function addFeatureGroupsToParentElement(a,b,c,f){var e=$("<div></div>");e.addClass("featureBranch");e.addClass("featureBranchClosed");var d=getTextForFeatureGroup(a),d=$('<h4 class="featureBox ui-corner-all" style="padding-left:'+settings.standardIdentation*f+'px;">'+d+"</h4>");d.addClass("featureHover");e.append(d);d.prepend($('<div class="ui-icon ui-icon-plusthick" style="float:left;"></div>'));var g=$('<input type="hidden" class="featureBranchName" value="'+a+'"></input>');d.append(g);g=getOverlapSummaryForGroup(a);
""!=g&&(g=$('<input type="hidden" class="featureBranchOverlapPrefixes" value="'+g+'"></input>'),e.append(g));c.append(e);currentState.featuresElements[a]=d;var i=[];$.each(b,function(a){i.push([getGroupOrderElem(a),a])});i.sort();$.each(i,function(a,c){var d=c[1],g=b[d];"featureBox"!=d?addFeatureGroupsToParentElement(d,g,e,f+1):addFeatureBoxesToParentElement(d,g,e,f+1)})}
function addFeatureBoxesToParentElement(a,b,c,f){var e=[];$.each(b,function(a,b){e.push([getGroupOrderElem(b[0]),a])});e.sort();$.each(e,function(a,e){var a=e[1],i=b[a],h=$("<div></div>");h.addClass("featureBox");h.addClass("featureBoxClosed");var k=getTextForFeaturePrefix(i[0]),k=$('<h4 class="featureBox ui-corner-all" style="padding-left:'+settings.standardIdentation*f+'px;">'+k+"</h4>");k.addClass("featureHover");if(0==f){var j=$('<input type="hidden" class="featureBoxName" value="'+i[0]+'"></input>');
k.append(j)}h.append(k);k.prepend($('<div class="ui-icon ui-icon-search" style="float:left;"></div>'));var l=getTypeForFeaturePrefix(i[0]);h.addClass(l);if("featureText"==l||"featureRange"==l||"featureRatio"==l||"featureNeighborhood"==l)k=$('<input type="hidden" value="'+i[0]+'"></input>'),j=$('<input type="hidden" value="'+l+'"></input>'),h.append(k),h.append(j),"featureText"==l&&1<i.length?(j=getTypeForFeaturePrefix(i[1]),k=$('<input type="hidden" value="'+i[1]+'"></input>'),j=$('<input type="hidden" value="'+
j+'"></input>'),h.append(k),h.append(j)):"featureRange"==l&&3==i.length?(k=$('<input type="hidden" value="'+i[1]+'"></input>'),j=$('<input type="hidden" value="'+i[2]+'"></input>'),h.append(k),h.append(j)):"featureRatio"==l&&3==i.length?(k=$('<input type="hidden" value="'+i[1]+'"></input>'),j=$('<input type="hidden" value="'+i[2]+'"></input>'),h.append(k),h.append(j)):"featureNeighborhood"==l&&3==i.length&&(k=$('<input type="hidden" value="'+i[1]+'"></input>'),j=$('<input type="hidden" value="'+i[2]+
'"></input>'),h.append(k),h.append(j));else if("featureTable"==l){var m=[];i[0].startsWith("GENENAME:ENSEMBL")?m=["gene","Egn:*","gene"]:i[0].startsWith("GO:ALL")?m=["","gGO:*","GOterm gGONG:000--gGONG:999"]:i[0].startsWith("GO:TERMS")?m=["gGOd:*","gGO:*","GOterm"]:i[0].startsWith("OMIM:ALL")?m=["","omimID:*","omim gOMIMNG:00--gOMIMNG:99"]:i[0].startsWith("OMIM:TERMS")&&(m=["omimD:*","omimID:*","omim"]);var k=$('<input type="hidden" value="'+i[0]+'"></input>'),j=$('<input type="hidden" value="'+l+
'"></input>'),l=$('<input type="hidden" value="'+m[0]+'"></input>'),r=$('<input type="hidden" value="'+m[1]+'"></input>'),m=$('<input type="hidden" value="'+m[2]+'"></input>');h.append(k);h.append(j);h.append(l);h.append(r);h.append(m)}else"featureRegionsList"==l&&(k=$('<input type="hidden" value="Eregion"></input>'),j=$('<input type="hidden" value="'+l+'"></input>'),h.append(k),h.append(j));c.append(h);currentState.featuresElements[i[0]]=h})}
function processFeatureArray(a){currentState.featuresElements={};currentState.featureCurrentVisualization=settings.genome+"summary";$(".features").children().remove();var b=$('<div id="featureListingTree"></div>');$(".features").append(b);var c=[];$.each(a,function(a){c.push([getGroupOrderElem(a),a])});c.sort();var f=!0;$.each(c,function(c,d){var g=d[1],i=a[g];if(f&&40<=d[0]||99==d[0])b.append($('<hr class="dottedlineTransparent"></hr>')),f=!1;"featureBox"!=g?addFeatureGroupsToParentElement(g,i,b,
0):addFeatureBoxesToParentElement(g,i,b,0)});$(".featureBranchClosed").children("div").hide();$(".featureBranchClosed > h4").click(function(){featureOpenBranch(this,!0)});$(".featureBoxClosed").one("click",featureOpenBox)}
function initFeatures(a){void 0!==currentState.datasetFeatures[currentState.exploreRegionSelected]?a&&processFeatureArray(currentState.datasetFeatures[currentState.exploreRegionSelected]):$.ajax({type:"GET",url:"relay.php",async:!1,dataType:"json",data:"type=getfeatures&regiontype="+currentState.exploreRegionSelected+"&genome="+settings.genome,success:function(b){currentState.datasetFeatures[currentState.exploreRegionSelected]=b;a&&processFeatureArray(b)}})}
function autoCompleteCallbackGOterm(a){a=a.term.toUpperCase();if(/^[0-9A-Za-z]*$/.test(a)){var a=["GO:TERMS:","gGOd:"+a+"*","gGO:*","GOterm",!1],b=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",currentState.exploreRegionSelected,b,200,0,"",a)}else alert("This field allows only letters and numbers")}
function autoCompleteCallbackOMIMterm(a){a=a.term.toUpperCase();if(/^[0-9A-Za-z]*$/.test(a)){var a=["OMIM:TERMS:","omimD:"+a+"*","omimID:*","omim",!1],b=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",currentState.exploreRegionSelected,b,200,0,"",a)}else alert("This field allows only letters and numbers")}
function autoCompleteCallbackGene(a){parts=["gene","Egn:*","gene"];a=a.term.toUpperCase();if(/^[0-9A-Za-z]*$/.test(a)){var a=["GENENAME:ENSEMBL:","gS:"+a+"* gene","Egn:*","gene",!1],b=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",currentState.exploreRegionSelected,b,0,200,"",a)}else alert("This field allows only letters and numbers")}
function autoCompleteCallbackGOcategory(a){var a=a.term.toUpperCase().split(" "),b=[],c=/^[0-9A-Za-z]*$/;$.each(a,function(a,d){c.test(d)?b.push("gGOd:"+d+"*"):alert("This field allows only letters and numbers")});b.push("GOterm");var a=$("select.minGenesOFGO option:selected").val(),f=$("select.maxGenesOFGO option:selected").val();b.push("GOterm gGONG:"+a+"--gGONG:"+f);a=["GO:ALL:","","gGO:*",b.join(" "),!1];f=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",
currentState.exploreRegionSelected,f,100,0,"rw=1d",a)}
function autoCompleteCallbackOMIMcategory(a){var a=a.term.toUpperCase().split(" "),b=[],c=/^[0-9A-Za-z]*$/;$.each(a,function(a,d){c.test(d)?b.push("omimD:"+d+"*"):alert("This field allows only letters and numbers")});b.push("omim");b.push("gOMIMNG:00--gOMIMNG:99");var a=["OMIM:ALL:","","omimID:*",b.join(" "),!1],f=getQueryComplexJoin(" ","Eregion",a[1],a[2],a[3]);updateOpenedFeatureCore("featureTable",currentState.exploreRegionSelected,f,100,0,"rw=1d",a)}
function loadVisualizationByID(a){if(void 0!==currentState.featuresElements[a]){for(var b=currentState.featuresElements[a].parent(),c=[];b.hasClass("featureBranch");)b.hasClass("featureBranchOpened")||c.push(b),b=b.parent();$.each(c.reverse(),function(a,b){featureOpenBranch(b.children("h4.featureBox"),!1)});$(currentState.featuresElements[a]).click()}};